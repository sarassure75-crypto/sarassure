var re=Object.defineProperty,se=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var J=(l,o,s)=>o in l?re(l,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[o]=s,$=(l,o)=>{for(var s in o||(o={}))le.call(o,s)&&J(l,s,o[s]);if(Y)for(var s of Y(o))ne.call(o,s)&&J(l,s,o[s]);return l},R=(l,o)=>se(l,ie(o));var P=(l,o,s)=>new Promise((b,i)=>{var h=g=>{try{u(s.next(g))}catch(x){i(x)}},a=g=>{try{u(s.throw(g))}catch(x){i(x)}},u=g=>g.done?b(g.value):Promise.resolve(g.value).then(h,a);u((s=s.apply(l,o)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as y}from"./react-vendor-6cf6ded9.js";import{i as de,e as F,s as A,u as oe,aB as ce}from"./index-426aa6f1.js";import{A as T}from"./AdminTabNavigation-8abb78e2.js";import{w as ae,bj as me,bk as xe,a3 as te,ac as V,u as ue,H as z,B as ge,A as pe,ai as he,X as ee,v as be}from"./ui-icons-e73ce4f7.js";import{S as fe}from"./StepAreaEditor-aceba418.js";import"./supabase-4b7d20da.js";import"./select-6c123d42.js";import"./index-d203b311.js";import"./index-cc17d877.js";import"./IconSelector-7450d470.js";function je({steps:l=[]}){const[o,s]=y.useState(0),[b,i]=y.useState(1),h=m=>{if(!m)return null;try{return typeof m=="string"?JSON.parse(m):m}catch(v){return console.error("Error parsing area data:",v),null}};if(!l||l.length===0)return e.jsx("div",{className:"bg-gray-50 rounded-lg p-8 text-center border border-gray-200",children:e.jsx("p",{className:"text-gray-600",children:"Aucune Ã©tape Ã  visualiser"})});const a=l[o],u=a==null?void 0:a.image_url,g=()=>{o>0&&(s(o-1),i(1))},x=()=>{o<l.length-1&&(s(o+1),i(1))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Visualisation des Ã©tapes"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Ã‰tape ",o+1," / ",l.length]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-6",children:u?e.jsxs("div",{className:"relative mx-auto inline-block",style:{maxWidth:"400px"},children:[e.jsx("img",{src:a.image_url,alt:`Ã‰tape ${o+1}`,className:"w-full h-full object-fill rounded-lg border border-gray-200 block",style:{transform:`scale(${b})`,transformOrigin:"center"}}),[{data:h(a.target_area),color:"rgba(239, 68, 68, 0.3)",borderColor:"#ef4444",label:"Cible"},{data:h(a.text_input_area),color:"rgba(59, 130, 246, 0.3)",borderColor:"#3b82f6",label:"Saisie"},{data:h(a.start_area),color:"rgba(34, 197, 94, 0.3)",borderColor:"#22c55e",label:"DÃ©part"}].map((m,v)=>{var q,r,p,w,S,t,n,c;if(!m.data)return null;const Z=(r=(q=m.data.x_percent)!=null?q:m.data.x)!=null?r:0,_=(w=(p=m.data.y_percent)!=null?p:m.data.y)!=null?w:0,D=(t=(S=m.data.width_percent)!=null?S:m.data.width)!=null?t:10,C=(c=(n=m.data.height_percent)!=null?n:m.data.height)!=null?c:10;return e.jsx("div",{className:"absolute border-2 pointer-events-none",style:{left:`${Z}%`,top:`${_}%`,width:`${D}%`,height:`${C}%`,backgroundColor:m.data.color?m.data.color.replace("rgb","rgba").replace(")",`, ${m.data.opacity||.3})`):m.color,borderColor:m.data.color||m.borderColor,borderRadius:m.data.shape==="ellipse"?"50%":"4px"},children:e.jsx("div",{className:"absolute -top-6 left-0 bg-white/90 px-2 py-0.5 rounded text-xs font-medium",style:{borderColor:m.borderColor},children:m.label})},v)}),!(a.target_area||a.text_input_area||a.start_area)&&e.jsx("div",{className:"absolute top-2 left-2 bg-amber-100 border border-amber-300 rounded px-3 py-1 text-xs text-amber-800",children:"â„¹ï¸ Aucune zone d'action dÃ©finie"})]}):e.jsxs("div",{className:"text-gray-400 text-center p-8",children:[e.jsx("p",{className:"font-semibold mb-2",children:"âš ï¸ Image non disponible"}),e.jsxs("p",{className:"text-xs",children:["URL: ",a.image_url||"N/A"]})]})}),e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Instruction:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:a.instruction})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Action:"}),e.jsx("span",{className:"ml-2 text-gray-900 font-mono bg-gray-200 px-2 py-1 rounded text-xs",children:a.action_type})]}),a.expected_input&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Saisie attendue:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:a.expected_input})]})]})})]}),l.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:g,disabled:o===0,className:"flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"PrÃ©cÃ©dente"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex space-x-1",children:l.map((m,v)=>e.jsx("button",{onClick:()=>s(v),className:`w-8 h-8 rounded-full text-sm font-medium transition-colors ${v===o?"bg-blue-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:v+1},v))}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:()=>i(Math.max(.5,b-.1)),className:"text-gray-600 hover:text-gray-900",title:"Zoom arriÃ¨re",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 px-2",children:[Math.round(b*100),"%"]}),e.jsx("button",{onClick:()=>i(Math.min(2,b+.1)),className:"text-gray-600 hover:text-gray-900",title:"Zoom avant",children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsxs("button",{onClick:x,disabled:o===l.length-1,className:"flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx("span",{children:"Suivante"}),e.jsx(te,{className:"w-4 h-4"})]})]})]})}function ye({steps:l=[],onStepsUpdate:o}){const[s,b]=y.useState(0),[i,h]=y.useState(null),[a,u]=y.useState(!1),{toast:g}=de(),x=l[s],m=r=>{h($({},r))},v=()=>{h(null)},Z=()=>P(this,null,function*(){if(i){u(!0);try{const r={};i.target_area_data&&(r.target_area=JSON.stringify(i.target_area_data)),i.text_input_area_data&&(r.text_input_area=JSON.stringify(i.text_input_area_data)),i.start_area_data&&(r.start_area=JSON.stringify(i.start_area_data));const{error:p}=yield A.from("steps").update(r).eq("id",i.id);if(p)throw p;const w=[...l],S=w.findIndex(t=>t.id===i.id);S>=0&&(w[S]=R($($({},w[S]),r),{target_area_data:i.target_area_data,text_input_area_data:i.text_input_area_data,start_area_data:i.start_area_data})),o==null||o(w),h(null),g({title:"âœ… Zone d'action sauvegardÃ©e",description:"Les modifications ont Ã©tÃ© enregistrÃ©es avec succÃ¨s."})}catch(r){console.error("Erreur sauvegarde:",r),g({title:"âŒ Erreur de sauvegarde",description:r.message,variant:"destructive"})}finally{u(!1)}}}),_=r=>{if(!r)return null;try{return typeof r=="string"?JSON.parse(r):r}catch(p){return console.error("Error parsing area data:",p),null}},D=(r,p)=>{i&&h(R($({},i),{[`${r}_data`]:p}))},C=()=>{s>0&&(b(s-1),h(null))},q=()=>{s<l.length-1&&(b(s+1),h(null))};return y.useEffect(()=>{i&&!i.target_area_data&&!i.text_input_area_data&&!i.start_area_data&&h(R($({},i),{target_area_data:_(i.target_area),text_input_area_data:_(i.text_input_area),start_area_data:_(i.start_area)}))},[i]),x?e.jsxs("div",{className:"space-y-4",children:[l.length>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{onClick:C,disabled:s===0,variant:"outline",size:"sm",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"PrÃ©cÃ©dente"]}),e.jsx("div",{className:"flex gap-2",children:l.map((r,p)=>e.jsx("button",{onClick:()=>{b(p),h(null)},className:`w-8 h-8 rounded-full text-sm font-medium transition-colors ${p===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-900 hover:bg-gray-300"}`,children:p+1},p))}),e.jsxs(F,{onClick:q,disabled:s===l.length-1,variant:"outline",size:"sm",children:["Suivante",e.jsx(te,{className:"w-4 h-4 ml-1"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Ã‰tape ",s+1," / ",l.length]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:x.instruction}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Action: ",e.jsx("span",{className:"font-medium",children:x.action_type})]})]}),!i&&e.jsxs(F,{onClick:()=>m(x),variant:"outline",size:"sm",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Ã‰diter zones"]})]})}),e.jsx("div",{className:"p-6",children:i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"ðŸŽ¯ Ã‰dition des zones d'action"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Vous pouvez modifier les zones d'action pour corriger les erreurs de proportions."})]}),["target_area","text_input_area","start_area"].map(r=>{const p=i[`${r}_data`];if(!(r==="target_area"&&["tap","double_tap","long_press"].includes(i.action_type)||r==="text_input_area"&&["text_input","number_input"].includes(i.action_type)||r==="start_area"&&["swipe_left","swipe_right","swipe_up","swipe_down","scroll","drag_and_drop"].includes(i.action_type)))return null;const S={target_area:"Zone cible (tap/clic)",text_input_area:"Zone de saisie (texte)",start_area:"Zone de dÃ©marrage (swipe/scroll)"};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:S[r]}),i.image_url?e.jsx(fe,{imageUrl:i.image_url,area:p,onAreaChange:t=>D(r,t)}):e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Image non disponible pour cette Ã©tape"})})]},r)}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx(F,{onClick:Z,disabled:a,className:"flex-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Sauvegarde..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Sauvegarder"]})}),e.jsx(F,{onClick:v,variant:"outline",disabled:a,children:"Annuler"})]})]}):e.jsxs("div",{className:"space-y-4",children:[x.image_url?e.jsxs("div",{className:"relative mx-auto inline-block",style:{maxWidth:"360px"},children:[e.jsx("img",{src:x.image_url,alt:`Ã‰tape ${s+1}`,className:"w-full h-auto rounded-lg border border-gray-200 block"}),[{data:_(x.target_area),color:"rgba(239, 68, 68, 0.3)",borderColor:"#ef4444",label:"Cible"},{data:_(x.text_input_area),color:"rgba(59, 130, 246, 0.3)",borderColor:"#3b82f6",label:"Saisie"},{data:_(x.start_area),color:"rgba(34, 197, 94, 0.3)",borderColor:"#22c55e",label:"DÃ©part"}].map((r,p)=>{var c,f,E,k,d,j,I,L;if(!r.data)return null;const w=(f=(c=r.data.x_percent)!=null?c:r.data.x)!=null?f:0,S=(k=(E=r.data.y_percent)!=null?E:r.data.y)!=null?k:0,t=(j=(d=r.data.width_percent)!=null?d:r.data.width)!=null?j:10,n=(L=(I=r.data.height_percent)!=null?I:r.data.height)!=null?L:10;return e.jsx("div",{className:"absolute border-2 pointer-events-none",style:{left:`${w}%`,top:`${S}%`,width:`${t}%`,height:`${n}%`,backgroundColor:r.data.color?r.data.color.replace("rgb","rgba").replace(")",`, ${r.data.opacity||.3})`):r.color,borderColor:r.data.color||r.borderColor,borderRadius:r.data.shape==="ellipse"?"50%":"4px"},children:e.jsx("div",{className:"absolute -top-6 left-0 bg-white/90 px-2 py-0.5 rounded text-xs font-medium",style:{borderColor:r.borderColor},children:r.label})},p)}),!(x.target_area||x.text_input_area||x.start_area)&&e.jsx("div",{className:"absolute top-2 left-2 bg-amber-100 border border-amber-300 rounded px-3 py-1 text-xs text-amber-800",children:"â„¹ï¸ Aucune zone d'action dÃ©finie"})]}):e.jsx("div",{className:"bg-gray-100 p-8 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-500",children:"Image non disponible pour cette Ã©tape"})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Instruction:"})," ",x.instruction]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Action:"})," ",x.action_type]})]})]})})]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Aucune Ã©tape Ã  afficher"})})}function qe(){const{currentUser:l}=oe(),{counters:o}=ce(),[s,b]=y.useState([]),[i,h]=y.useState(!0),[a,u]=y.useState(null),[g,x]=y.useState(null),[m,v]=y.useState(!1),[Z,_]=y.useState(!1),[D,C]=y.useState("");y.useEffect(()=>{q()},[]);const q=()=>P(this,null,function*(){h(!0);try{const{data:t,error:n}=yield A.from("versions").select(`
          *,
          task:task_id (
            id,
            title,
            description,
            category,
            owner_id,
            created_at,
            task_type
          ),
          steps (
            id,
            instruction,
            action_type,
            app_image_id,
            target_area,
            text_input_area,
            start_area,
            step_order,
            app_images:app_image_id (
              id,
              file_path,
              name
            )
          )
        `).eq("creation_status","pending").order("created_at",{ascending:!1});if(n)throw n;const c=(t||[]).filter(d=>d.task!==null&&(d.task.task_type==="exercise"||d.task.task_type===null)),f=[...new Set(c==null?void 0:c.map(d=>{var j;return(j=d.task)==null?void 0:j.owner_id}).filter(Boolean))];let E={};if(f.length>0){const{data:d}=yield A.from("profiles").select("id, first_name, last_name, email, role").in("id",f);d&&d.forEach(j=>{E[j.id]=j})}const k=(c==null?void 0:c.map(d=>{var L,H,G,U,X,K,Q;const j=E[(L=d.task)==null?void 0:L.owner_id]||{},I=((H=d.steps)==null?void 0:H.map(N=>{let B=null;const O=Array.isArray(N.app_images)?N.app_images[0]:N.app_images,M=O==null?void 0:O.file_path;if(console.log("Processing step:",{stepId:N.id,instruction:N.instruction,app_images:N.app_images,appImage:O,imagePath:M,target_area:N.target_area,text_input_area:N.text_input_area,start_area:N.start_area}),M){const{data:W}=A.storage.from("images").getPublicUrl(M);B=(W==null?void 0:W.publicUrl)||null,console.log("Generated URL for path:",M,"â†’",B)}return R($({},N),{image_url:B,image_path:M,app_image:O,target_area:N.target_area,text_input_area:N.text_input_area,start_area:N.start_area})}))||[];return{id:d.id,version_id:d.id,task_id:d.task_id,exercise_name:((G=d.task)==null?void 0:G.title)||"Exercice sans titre",exercise_description:((U=d.task)==null?void 0:U.description)||"Aucune description",name:d.name,difficulty_level:((K=(X=d.task)==null?void 0:X.creation_status)==null?void 0:K.difficulty)||"Non spÃ©cifiÃ©e",status:"pending",steps:I,images:[],contributor:{id:(Q=d.task)==null?void 0:Q.owner_id,first_name:j.first_name||"Utilisateur",last_name:j.last_name||"Anonyme",email:j.email||"N/A",role:j.role||"contributor"},created_at:d.created_at,task:d.task,version:d}}))||[];b(k),k.length>0&&u(k[0])}catch(t){console.error("Erreur:",t),alert("Erreur: "+t.message)}finally{h(!1)}}),r=t=>P(this,null,function*(){x(t);try{const{error:n}=yield A.from("versions").update({creation_status:"validated"}).eq("id",t);if(n)throw n;b(s.filter(c=>c.id!==t)),s.length>1?u(s.find(c=>c.id!==t)):u(null),alert("âœ… Contribution approuvÃ©e!")}catch(n){console.error("Erreur:",n),alert("âŒ Erreur: "+n.message)}finally{x(null)}}),p=t=>P(this,null,function*(){var c;const n=prompt("Raison du rejet:");if(n){x(t);try{const f=s.find(d=>d.id===t),E=(c=f==null?void 0:f.task)==null?void 0:c.owner_id,{error:k}=yield A.from("versions").update({creation_status:"rejected",admin_comments:n,reviewer_id:l==null?void 0:l.id,reviewed_at:new Date().toISOString()}).eq("id",t);if(k)throw k;if(E){const{data:d,error:j}=yield A.rpc("apply_rejection_penalty",{p_contributor_id:E,p_version_id:t,p_reason:n});j?console.error("Erreur lors de l'application de la pÃ©nalitÃ©:",j):console.log("PÃ©nalitÃ© appliquÃ©e:",d)}b(s.filter(d=>d.id!==t)),s.length>1?u(s.find(d=>d.id!==t)):u(null),alert("âœ… Contribution rejetÃ©e avec pÃ©nalitÃ© appliquÃ©e")}catch(f){console.error("Erreur:",f),alert("âŒ Erreur: "+f.message)}finally{x(null)}}}),w=(t,n)=>P(this,null,function*(){if(!n.trim()){alert("Veuillez saisir des commentaires pour les corrections demandÃ©es.");return}x(t);try{const{error:c}=yield A.from("versions").update({creation_status:"needs_changes",admin_comments:n.trim(),reviewer_id:l==null?void 0:l.id,reviewed_at:new Date().toISOString()}).eq("id",t);if(c)throw c;b(s.filter(f=>f.id!==t)),s.length>1?u(s.find(f=>f.id!==t)):u(null),_(!1),C(""),alert("âœ… Demande de modification envoyÃ©e au contributeur!")}catch(c){console.error("Erreur:",c),alert("âŒ Erreur: "+c.message)}finally{x(null)}}),S=t=>P(this,null,function*(){if(confirm("ÃŠtes-vous sÃ»r?")){x(t);try{const{error:n}=yield A.from("versions").delete().eq("id",t);if(n)throw n;b(s.filter(c=>c.id!==t)),s.length>1?u(s.find(c=>c.id!==t)):u(null),alert("âœ… Contribution supprimÃ©e")}catch(n){console.error("Erreur:",n),alert("âŒ Erreur: "+n.message)}finally{x(null)}}});return i?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]})}):s.length===0?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"bg-white rounded-lg border shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col space-y-1.5 p-6",children:[e.jsxs("h3",{className:"flex items-center text-3xl font-semibold leading-none tracking-tight",children:[e.jsx(z,{className:"mr-3 h-8 w-8 text-primary"}),"Validation des exercices"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Validez les exercices soumis par les contributeurs"})]})}),e.jsx(T,{counters:o}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Aucune contribution Ã  valider"}),e.jsx("p",{className:"text-gray-600",children:"Toutes les contributions en attente ont Ã©tÃ© validÃ©es!"})]})]}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"bg-white rounded-lg border shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col space-y-1.5 p-6",children:[e.jsxs("h3",{className:"flex items-center text-3xl font-semibold leading-none tracking-tight",children:[e.jsx(z,{className:"mr-3 h-8 w-8 text-primary"}),"Validation des exercices"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.length," contribution(s) en attente de validation"]})]})}),e.jsx(T,{counters:o}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a&&e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a.exercise_name||"Exercice sans titre"}),e.jsx("p",{className:"text-gray-600",children:a.exercise_description||"Aucune description"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"DifficultÃ©"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:a.difficulty_level||"N/A"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Statut"}),e.jsx("p",{className:"text-lg font-bold text-green-900 capitalize",children:a.status})]})]}),a.steps&&Array.isArray(a.steps)&&a.steps.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Ã‰tapes (",a.steps.length,")"]}),e.jsxs("button",{onClick:()=>v(!m),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${m?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:[e.jsx(V,{className:"w-4 h-4"}),m?"Mode aperÃ§u":"Ã‰diter zones"]})]}),m?e.jsx(ye,{steps:a.steps,onStepsUpdate:t=>{u(R($({},a),{steps:t}))}}):e.jsx(je,{steps:a.steps})]}),a.images&&Array.isArray(a.images)&&a.images.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3",children:["Images (",a.images.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.images.map((t,n)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg overflow-hidden border border-gray-200",children:[t.url&&e.jsx("img",{src:t.url,alt:`Image ${n+1}`,className:"w-full h-40 object-cover"}),e.jsx("div",{className:"p-2",children:e.jsx("p",{className:"text-xs text-gray-600",children:t.name||`Image ${n+1}`})})]},n))})]}),a.contributor&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Soumis par"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:[a.contributor.first_name," ",a.contributor.last_name]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.contributor.email}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["RÃ´le: ",e.jsx("span",{className:"font-medium",children:a.contributor.role})]})]}),e.jsx("div",{className:"text-sm text-gray-600 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{children:["Soumis le: ",new Date(a.created_at).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(pe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Ã€ vÃ©rifier avant d'approuver:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"La contribution est pertinente"}),e.jsx("li",{children:"Les Ã©tapes sont claires"}),e.jsx("li",{children:"Pas de contenu dupliquÃ©"}),e.jsx("li",{children:"Contenu appropriÃ© pour l'app"})]})]})]})}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>r(a.id),disabled:g===a.id,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:"Approuver"})]}),e.jsxs("button",{onClick:()=>{_(!0),C("")},disabled:g===a.id,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{children:"Ã€ corriger"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>p(a.id),disabled:g===a.id,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors disabled:opacity-50 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Rejeter"})]}),e.jsxs("button",{onClick:()=>S(a.id),disabled:g===a.id,className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition-colors disabled:opacity-50 text-sm",title:"Supprimer",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Supprimer"})]})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("h3",{className:"font-semibold text-gray-900",children:["En attente (",s.length,")"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.map(t=>{var n,c;return e.jsxs("button",{onClick:()=>u(t),className:`w-full p-3 text-left border-b transition-colors ${(a==null?void 0:a.id)===t.id?"bg-blue-50 border-l-4 border-l-blue-600":"hover:bg-gray-50"}`,children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:t.exercise_name||"Sans titre"}),e.jsxs("p",{className:"text-xs text-gray-600",children:[(n=t.contributor)==null?void 0:n.first_name," ",(c=t.contributor)==null?void 0:c.last_name]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleDateString("fr-FR")})]},t.id)})})]})})]}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Demander des corrections"}),e.jsx("button",{onClick:()=>{_(!1),C("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-blue-800",children:e.jsx("strong",{children:"Cette action va :"})}),e.jsxs("ul",{className:"text-xs text-blue-700 mt-2 space-y-1",children:[e.jsx("li",{children:"â€¢ Renvoyer l'exercice dans les brouillons du contributeur"}),e.jsx("li",{children:"â€¢ Permettre au contributeur de voir vos commentaires"}),e.jsx("li",{children:"â€¢ Conserver le suivi de cet exercice pour Ã©viter les doublons"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commentaires pour le contributeur *"}),e.jsx("textarea",{value:D,onChange:t=>C(t.target.value),placeholder:"Expliquez les modifications Ã  apporter...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Soyez prÃ©cis et constructif dans vos commentaires."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{onClick:()=>w(a==null?void 0:a.id,D),disabled:g===(a==null?void 0:a.id)||!D.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors disabled:opacity-50",children:g===(a==null?void 0:a.id)?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Envoyer"})]})}),e.jsx("button",{onClick:()=>{_(!1),C("")},disabled:g===(a==null?void 0:a.id),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Annuler"})]})]})})})]})}export{qe as default};
