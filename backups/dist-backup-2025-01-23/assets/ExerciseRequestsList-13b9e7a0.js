var y=(o,x,i)=>new Promise((d,a)=>{var h=c=>{try{l(i.next(c))}catch(s){a(s)}},u=c=>{try{l(i.throw(c))}catch(s){a(s)}},l=c=>c.done?d(c.value):Promise.resolve(c.value).then(h,u);l((i=i.apply(o,x)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as n}from"./react-vendor-6cf6ded9.js";import{C as p,j,I as A,X as g,k as E,l as R,w as S}from"./index-426aa6f1.js";import{S as k}from"./scroll-area-8a7e81aa.js";import{f as z}from"./exerciseRequests-4362563c.js";import{z as f,a7 as v,Q as T,b7 as C,a$ as L,b5 as I,p as P,b6 as X,y as D}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";import"./index-d203b311.js";const N={high:{label:"Prioritaire",icon:I,color:"text-red-600 bg-red-50"},normal:{label:"Normal",icon:P,color:"text-blue-600 bg-blue-50"},low:{label:"Optionnel",icon:X,color:"text-gray-600 bg-gray-50"}},b={pending:{label:"À faire",icon:L,color:"text-yellow-600 bg-yellow-50"},in_progress:{label:"En cours",icon:v,color:"text-blue-600 bg-blue-50"},completed:{label:"Terminé",icon:C,color:"text-green-600 bg-green-50"},cancelled:{label:"Annulé",icon:D,color:"text-gray-600 bg-gray-50"}};function F(){const[o,x]=n.useState([]),[i,d]=n.useState(!0),[a,h]=n.useState("");n.useEffect(()=>{u()},[]);const u=()=>y(this,null,function*(){d(!0);try{const s=yield z({});x(s.filter(t=>t.status!=="completed"&&t.status!=="cancelled"))}catch(s){console.error("Error loading exercise requests:",s)}finally{d(!1)}}),l=n.useMemo(()=>a?o.filter(s=>{var t,m;return s.title.toLowerCase().includes(a.toLowerCase())||s.code.toLowerCase().includes(a.toLowerCase())||((t=s.description)==null?void 0:t.toLowerCase().includes(a.toLowerCase()))||((m=s.category)==null?void 0:m.name.toLowerCase().includes(a.toLowerCase()))}):o,[o,a]),c=n.useMemo(()=>({high:l.filter(t=>t.priority==="high"),normal:l.filter(t=>t.priority==="normal"),low:l.filter(t=>t.priority==="low")}),[l]);return i?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement des demandes..."})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(f,{className:"h-8 w-8 text-primary"}),"Liste des exercices à créer"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Consultez les exercices demandés. Utilisez le code lors de la création."})]}),e.jsx(p,{className:"bg-blue-50 border-blue-200",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(v,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Comment utiliser cette liste ?"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Choisissez un exercice à créer (priorité "Prioritaire" recommandée)'}),e.jsxs("li",{children:["Notez le ",e.jsx("strong",{children:"code de référence"})," (ex: EX-2025-001)"]}),e.jsx("li",{children:"Lors de la création, indiquez ce code pour lier votre contribution"}),e.jsx("li",{children:"Votre exercice sera automatiquement associé à la demande"})]})]})]})})}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Rechercher par titre, code, catégorie...",value:a,onChange:s=>h(s.target.value),className:"pl-10"})]}),e.jsx(k,{className:"h-[calc(100vh-400px)]",children:e.jsxs("div",{className:"space-y-6",children:[Object.entries(c).map(([s,t])=>{if(t.length===0)return null;const m=N[s].icon;return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(m,{className:`h-5 w-5 ${N[s].color.split(" ")[0]}`}),N[s].label,e.jsx(g,{variant:"secondary",children:t.length})]}),e.jsx("div",{className:"grid gap-4",children:t.map(r=>{var w;const _=b[r.status].icon;return e.jsxs(p,{className:"hover:shadow-md transition-shadow",children:[e.jsx(E,{children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("code",{className:"text-sm font-mono font-bold bg-primary/10 text-primary px-3 py-1 rounded border-2 border-primary/20",children:r.code}),e.jsxs(g,{className:b[r.status].color,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),b[r.status].label]}),r.category_name&&e.jsx(g,{variant:"outline",children:r.category_name})]}),e.jsx(R,{className:"text-lg",children:r.title}),r.description&&e.jsx(S,{className:"text-sm",children:r.description})]})})}),e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-600",children:r.validated_versions_count||0})," validée(s)"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"font-medium text-yellow-600",children:r.pending_versions_count||0})," en attente"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:((w=r.linked_task_ids)==null?void 0:w.length)||0})," exercice(s) lié(s)"]})]}),r.notes&&e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded-md text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Consignes :"}),e.jsx("p",{className:"text-muted-foreground",children:r.notes})]})]})]},r.id)})})]},s)}),l.length===0&&e.jsx(p,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Aucun exercice à créer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Aucun résultat pour cette recherche":"Toutes les demandes sont terminées ou annulées"})]})})]})})]})}export{F as default};
