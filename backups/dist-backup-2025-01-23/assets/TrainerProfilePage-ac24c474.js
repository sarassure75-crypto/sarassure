var T=Object.defineProperty,G=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var _=(s,t,a)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,x=(s,t)=>{for(var a in t||(t={}))q.call(t,a)&&_(s,a,t[a]);if(M)for(var a of M(t))F.call(t,a)&&_(s,a,t[a]);return s},f=(s,t)=>G(s,L(t));var j=(s,t,a)=>new Promise((n,p)=>{var b=l=>{try{c(a.next(l))}catch(i){p(i)}},y=l=>{try{c(a.throw(l))}catch(i){p(i)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(b,y);c((a=a.apply(s,t)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{f as B,r as u}from"./react-vendor-6cf6ded9.js";import{u as H,s as w,C as N,k as P,l as C,w as E,j as S,e as h}from"./index-426aa6f1.js";import{A as I,a as R}from"./alert-9353e410.js";import{a7 as J,b7 as K}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";function $(){const{currentUser:s,logout:t}=H(),a=B(),[n,p]=u.useState({full_name:"",email:""}),[b,y]=u.useState(!0),[c,l]=u.useState(!1),[i,d]=u.useState({type:"",text:""}),[m,g]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[z,v]=u.useState(!1);u.useEffect(()=>{if(!s){a("/login");return}A()},[s,a]);const A=()=>j(this,null,function*(){try{y(!0);const{data:r,error:o}=yield w.from("profiles").select("full_name, email").eq("id",s.id).single();if(o)throw o;p({full_name:(r==null?void 0:r.full_name)||"",email:(r==null?void 0:r.email)||s.email||""})}catch(r){console.error("Erreur lors du chargement du profil:",r),d({type:"error",text:"Erreur lors du chargement du profil"})}finally{y(!1)}}),D=r=>j(this,null,function*(){r.preventDefault();try{l(!0);const{error:o}=yield w.from("profiles").update({full_name:n.full_name}).eq("id",s.id);if(o)throw o;if(n.email!==s.email){const{error:k}=yield w.auth.updateUser({email:n.email});if(k)throw k}d({type:"success",text:"Profil mis à jour avec succès!"}),setTimeout(()=>d({type:"",text:""}),3e3)}catch(o){console.error("Erreur lors de la mise à jour:",o),d({type:"error",text:o.message||"Erreur lors de la mise à jour"})}finally{l(!1)}}),U=r=>j(this,null,function*(){if(r.preventDefault(),m.newPassword!==m.confirmPassword){d({type:"error",text:"Les mots de passe ne correspondent pas"});return}if(m.newPassword.length<6){d({type:"error",text:"Le mot de passe doit contenir au moins 6 caractères"});return}try{l(!0);const{error:o}=yield w.auth.updateUser({password:m.newPassword});if(o)throw o;d({type:"success",text:"Mot de passe mis à jour avec succès!"}),g({currentPassword:"",newPassword:"",confirmPassword:""}),v(!1),setTimeout(()=>d({type:"",text:""}),3e3)}catch(o){console.error("Erreur:",o),d({type:"error",text:o.message||"Erreur lors de la mise à jour du mot de passe"})}finally{l(!1)}});return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-gray-500",children:"Chargement..."})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-primary/80 px-6 py-8 rounded-t-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Mon Profil"}),e.jsx("p",{className:"text-white/90",children:"Gérez vos informations personnelles et vos paramètres de sécurité"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[i.text&&e.jsxs(I,{className:i.type==="error"?"bg-red-50 border-red-200":"bg-green-50 border-green-200",children:[i.type==="error"?e.jsx(J,{className:i.type==="error"?"text-red-600":"text-green-600"}):e.jsx(K,{className:"text-green-600"}),e.jsx(R,{className:i.type==="error"?"text-red-800":"text-green-800",children:i.text})]}),e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsx(C,{children:"Informations Personnelles"}),e.jsx(E,{children:"Modifiez votre nom et votre adresse email"})]}),e.jsx(S,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom Complet"}),e.jsx("input",{type:"text",value:n.full_name,onChange:r=>p(f(x({},n),{full_name:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:n.email,onChange:r=>p(f(x({},n),{email:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Un lien de confirmation sera envoyé si vous changez d'email"})]}),e.jsx(h,{type:"submit",disabled:c,className:"w-full bg-primary hover:bg-primary/90",children:c?"Mise à jour...":"Enregistrer les modifications"})]})})]}),e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsx(C,{children:"Sécurité"}),e.jsx(E,{children:"Gérez votre mot de passe"})]}),e.jsx(S,{children:z?e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau mot de passe"}),e.jsx("input",{type:"password",value:m.newPassword,onChange:r=>g(f(x({},m),{newPassword:r.target.value})),placeholder:"Minimum 6 caractères",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",value:m.confirmPassword,onChange:r=>g(f(x({},m),{confirmPassword:r.target.value})),placeholder:"Confirmez le mot de passe",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{type:"submit",disabled:c,className:"flex-1 bg-primary hover:bg-primary/90",children:c?"Mise à jour...":"Mettre à jour"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>{v(!1),g({currentPassword:"",newPassword:"",confirmPassword:""})},className:"flex-1",children:"Annuler"})]})]}):e.jsx(h,{variant:"outline",onClick:()=>v(!0),className:"w-full border-primary text-primary hover:bg-primary/10",children:"Changer le mot de passe"})})]}),e.jsxs(N,{className:"border-red-200 bg-red-50",children:[e.jsxs(P,{children:[e.jsx(C,{className:"text-red-900",children:"Session"}),e.jsx(E,{className:"text-red-800",children:"Gérez votre session actuelle"})]}),e.jsx(S,{children:e.jsx(h,{variant:"destructive",onClick:t,className:"w-full",children:"Se déconnecter"})})]})]})]})})})}export{$ as default};
