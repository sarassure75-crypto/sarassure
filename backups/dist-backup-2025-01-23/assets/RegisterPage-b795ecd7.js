var S=(d,x,r)=>new Promise((u,n)=>{var p=s=>{try{c(r.next(s))}catch(i){n(i)}},o=s=>{try{c(r.throw(s))}catch(i){n(i)}},c=s=>s.done?u(s.value):Promise.resolve(s.value).then(p,o);c((r=r.apply(d,x)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as a,f as B,L as C}from"./react-vendor-6cf6ded9.js";import{aR as m,i as $,u as H,m as R,C as E,k as L,l as V,w as k,j as A,Y as l,$ as I,e as z,I as v,aV as J}from"./index-426aa6f1.js";import{S as M,a as O,b as Y,c as G,d as F}from"./select-6c123d42.js";import{k as K,$ as Q,p as W,aU as X}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";import"./index-d203b311.js";import"./index-cc17d877.js";const oe=()=>{const[d,x]=a.useState(""),[r,u]=a.useState(""),[n,p]=a.useState(""),[o,c]=a.useState(m.LEARNER),[s,i]=a.useState(!1),[U,q]=a.useState(!1),[h,P]=a.useState(null),f=B(),{toast:g}=$(),{signUp:T}=H(),D=t=>S(void 0,null,function*(){t.preventDefault(),i(!0);try{const{data:j,error:b}=yield T({email:d,password:r,options:{data:{first_name:n,role:o}}});if(b)throw b;if(o===m.LEARNER){let N=null;for(let y=0;y<5;y++){yield new Promise(_=>setTimeout(_,500));const w=yield J(j.user.id);if(w){N=w;break}}N?(P(N),q(!0)):(g({title:"Inscription presque terminée !",description:"Veuillez vérifier vos emails pour confirmer votre compte. Votre code vous sera accessible après connexion.",duration:7e3}),f("/login"))}else g({title:"Inscription réussie !",description:"Veuillez vérifier vos emails pour confirmer votre compte."}),f("/login")}catch(j){g({title:"Erreur d'inscription",description:j.message||"Une erreur est survenue.",variant:"destructive"})}finally{i(!1)}});return U&&h?e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 to-emerald-200 p-4",children:e.jsxs(E,{className:"w-full max-w-md shadow-2xl border-2 border-green-400",children:[e.jsxs(L,{className:"text-center bg-green-500 text-white p-6 rounded-t-lg",children:[e.jsx(K,{size:48,className:"mx-auto mb-3"}),e.jsx(V,{className:"text-2xl font-bold",children:"Inscription Réussie !"}),e.jsx(k,{className:"text-green-50",children:"Notez bien vos informations de connexion."})]}),e.jsxs(A,{className:"space-y-6 p-6 text-center",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(l,{className:"text-sm text-green-600",children:"Votre Prénom :"}),e.jsx("p",{className:"text-2xl font-semibold text-green-800",children:h.first_name})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(l,{className:"text-sm text-green-600",children:"Votre Code Secret (pour la connexion simplifiée) :"}),e.jsx("p",{className:"text-4xl font-bold tracking-wider text-green-800",children:h.learner_code||"En attente..."})]}),e.jsxs("div",{className:"flex items-start p-3 bg-yellow-50 border border-yellow-300 text-yellow-700 rounded-md text-sm",children:[e.jsx(Q,{className:"mr-2 h-5 w-5 mt-0.5 text-yellow-600 flex-shrink-0"}),e.jsx("p",{className:"text-left",children:"Un email de confirmation a été envoyé. Vous devez valider votre email avant de pouvoir vous connecter."})]})]}),e.jsx(I,{children:e.jsxs(z,{onClick:()=>f("/login"),className:"w-full h-12 text-lg bg-green-600 hover:bg-green-700",children:["Aller à la page de connexion ",e.jsx(W,{className:"ml-2 h-5 w-5"})]})})]})}):e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center min-h-screen bg-background p-4",children:e.jsxs(E,{className:"w-full max-w-md shadow-2xl",children:[e.jsxs(L,{className:"text-center",children:[e.jsx(V,{className:"text-3xl font-bold text-primary",children:"Créer un compte"}),e.jsx(k,{children:"Rejoignez la plateforme en quelques clics."})]}),e.jsxs("form",{onSubmit:D,children:[e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"firstName",children:"Prénom"}),e.jsx(v,{id:"firstName",value:n,onChange:t=>p(t.target.value),required:!0,disabled:s,placeholder:"Votre prénom"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email"}),e.jsx(v,{id:"email",type:"email",value:d,onChange:t=>x(t.target.value),required:!0,disabled:s,placeholder:"votre.email@exemple.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"password",children:"Mot de passe (6 caractères minimum)"}),e.jsx(v,{id:"password",type:"password",value:r,onChange:t=>u(t.target.value),required:!0,disabled:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"role",children:"Je suis un(e)"}),e.jsxs(M,{value:o,onValueChange:c,disabled:s,children:[e.jsx(O,{id:"role",children:e.jsx(Y,{placeholder:"Sélectionnez un rôle"})}),e.jsxs(G,{children:[e.jsx(F,{value:m.LEARNER,children:"Apprenant"}),e.jsx(F,{value:m.TRAINER,children:"Formateur"})]})]})]})]}),e.jsxs(I,{className:"flex flex-col",children:[e.jsx(z,{type:"submit",className:"w-full",disabled:s,children:s?"Création en cours...":e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," S'inscrire"]})}),e.jsxs("p",{className:"mt-4 text-xs text-center text-muted-foreground",children:["Déjà un compte ?"," ",e.jsx(C,{to:"/login",className:"underline underline-offset-2 text-primary hover:text-primary/80",children:"Se connecter"})]}),e.jsxs("p",{className:"mt-2 text-xs text-center text-muted-foreground",children:["Apprenant sans email ? Utilisez le"," ",e.jsx(C,{to:"/learner-login",className:"underline underline-offset-2 text-primary hover:text-primary/80",children:"code fourni par votre formateur"}),"."]})]})]})]})})};export{oe as default};
