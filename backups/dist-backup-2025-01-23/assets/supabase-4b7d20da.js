var d=(i,e,t)=>new Promise((r,s)=>{var n=l=>{try{a(t.next(l))}catch(c){s(c)}},o=l=>{try{a(t.throw(l))}catch(c){s(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((t=t.apply(i,e)).next())});import{g as Gt,c as R,a as Qt}from"./react-vendor-6cf6ded9.js";function Xt(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(i,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}const Yt="modulepreload",Zt=function(i){return"/"+i},ct={},te=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=Zt(n),n in ct)return;ct[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=s.length-1;u>=0;u--){const p=s[u];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":Yt,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((u,p)=>{c.addEventListener("load",u),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};var ht=function(){return ht=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},ht.apply(this,arguments)};function li(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t}function y(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(p){o(p)}}function l(u){try{c(r.throw(u))}catch(p){o(p)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(i,e||[])).next())})}function ci(i,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,n;r<s;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return i.concat(n||Array.prototype.slice.call(e))}const er=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>te(()=>Promise.resolve().then(()=>re),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Xe extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ut extends Xe{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class dt extends Xe{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ft extends Xe{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Fe;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(Fe||(Fe={}));class tr{constructor(e,{headers:t={},customFetch:r,region:s=Fe.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=er(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return y(this,arguments,void 0,function*(t,r={}){var s;try{const{headers:n,method:o,body:a,signal:l}=r;let c={},{region:u}=r;u||(u=this.region);const p=new URL(`${this.url}/${t}`);u&&u!=="any"&&(c["x-region"]=u,p.searchParams.set("forceFunctionRegion",u));let g;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)?typeof Blob!="undefined"&&a instanceof Blob||a instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",g=a):typeof a=="string"?(c["Content-Type"]="text/plain",g=a):typeof FormData!="undefined"&&a instanceof FormData?g=a:(c["Content-Type"]="application/json",g=JSON.stringify(a)):g=a;const v=yield this.fetch(p.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:g,signal:l}).catch(P=>{throw P.name==="AbortError"?P:new ut(P)}),b=v.headers.get("x-relay-error");if(b&&b==="true")throw new dt(v);if(!v.ok)throw new ft(v);let _=((s=v.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return _==="application/json"?m=yield v.json():_==="application/octet-stream"||_==="application/pdf"?m=yield v.blob():_==="text/event-stream"?m=v:_==="multipart/form-data"?m=yield v.formData():m=yield v.text(),{data:m,error:null,response:v}}catch(n){return n instanceof Error&&n.name==="AbortError"?{data:null,error:new ut(n)}:{data:null,error:n,response:n instanceof ft||n instanceof dt?n.context:void 0}}})}}var U={},Ye={},Oe={},fe={},ke={},Se={},rr=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")},ee=rr();const sr=ee.fetch,ir=ee.fetch.bind(ee),nr=ee.Headers,or=ee.Request,ar=ee.Response,re=Object.freeze(Object.defineProperty({__proto__:null,Headers:nr,Request:or,Response:ar,default:ir,fetch:sr},Symbol.toStringTag,{value:"Module"})),lr=Gt(re);var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});let cr=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Pe.default=cr;var Pt=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Se,"__esModule",{value:!0});const hr=Pt(lr),ur=Pt(Pe);let dr=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch=="undefined"?this.fetch=hr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(n=>d(this,null,function*(){var o,a,l,c;let u=null,p=null,g=null,v=n.status,b=n.statusText;if(n.ok){if(this.method!=="HEAD"){const C=yield n.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?p=C:p=JSON.parse(C))}const m=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),P=(l=n.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");m&&P&&P.length>1&&(g=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(u={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,g=null,v=406,b="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const m=yield n.text();try{u=JSON.parse(m),Array.isArray(u)&&n.status===404&&(p=[],u=null,v=200,b="OK")}catch(P){n.status===404&&m===""?(v=204,b="No Content"):u={message:m}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,v=200,b="OK"),u&&this.shouldThrowOnError)throw new ur.default(u)}return{error:u,data:p,count:g,status:v,statusText:b}}));return this.shouldThrowOnError||(s=s.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};Se.default=dr;var fr=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ke,"__esModule",{value:!0});const pr=fr(Se);let gr=class extends pr.default{select(e){let t=!1;const r=(e!=null?e:"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r=="undefined"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s=="undefined"?"offset":`${s}.offset`,o=typeof s=="undefined"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};ke.default=gr;var vr=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(fe,"__esModule",{value:!0});const _r=vr(ke);let yr=class extends _r.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};fe.default=yr;var mr=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oe,"__esModule",{value:!0});const ne=mr(fe);let wr=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const o=(e!=null?e:"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new ne.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;const n="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ne.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var o;const a="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new ne.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var r;const s="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new ne.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new ne.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};Oe.default=wr;var $t=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ye,"__esModule",{value:!0});const br=$t(Oe),Er=$t(fe);let Tr=class jt{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new br.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new jt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([p,g])=>g!==void 0).map(([p,g])=>[p,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([p,g])=>{l.searchParams.append(p,g)})):(a="POST",c=t);const u=new Headers(this.headers);return n&&u.set("Prefer",`count=${n}`),new Er.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};Ye.default=Tr;var se=R&&R.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(U,"__esModule",{value:!0});U.PostgrestError=U.PostgrestBuilder=U.PostgrestTransformBuilder=U.PostgrestFilterBuilder=U.PostgrestQueryBuilder=U.PostgrestClient=void 0;const At=se(Ye);U.PostgrestClient=At.default;const Ct=se(Oe);U.PostgrestQueryBuilder=Ct.default;const xt=se(fe);U.PostgrestFilterBuilder=xt.default;const Rt=se(ke);U.PostgrestTransformBuilder=Rt.default;const It=se(Se);U.PostgrestBuilder=It.default;const Bt=se(Pe);U.PostgrestError=Bt.default;var Or=U.default={PostgrestClient:At.default,PostgrestQueryBuilder:Ct.default,PostgrestFilterBuilder:xt.default,PostgrestTransformBuilder:Rt.default,PostgrestBuilder:It.default,PostgrestError:Bt.default};const{PostgrestClient:kr,PostgrestQueryBuilder:gi,PostgrestFilterBuilder:vi,PostgrestTransformBuilder:_i,PostgrestBuilder:yi,PostgrestError:mi}=Or;class Sr{static detectEnvironment(){var e;if(typeof WebSocket!="undefined")return{type:"native",constructor:WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocket!="undefined")return{type:"native",constructor:globalThis.WebSocket};if(typeof global!="undefined"&&typeof global.WebSocket!="undefined")return{type:"native",constructor:global.WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocketPair!="undefined"&&typeof globalThis.WebSocket=="undefined")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis!="undefined"&&globalThis.EdgeRuntime||typeof navigator!="undefined"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process!="undefined"){const t=process.versions;if(t&&t.node){const r=t.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket!="undefined"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch(e){return!1}}}const Pr="2.78.0",$r=`realtime-js/${Pr}`,jr="1.0.0",Ve=1e4,Ar=1e3,Cr=100;var le;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(le||(le={}));var A;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(A||(A={}));var H;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(H||(H={}));var Me;(function(i){i.websocket="websocket"})(Me||(Me={}));var X;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(X||(X={}));class xr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const l=r.decode(e.slice(o,o+n));o=o+n;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Dt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var S;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(S||(S={}));const pt=(i,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((n,o)=>(n[o]=Rr(o,i,e,s),n),{}):{}},Rr=(i,e,t,r)=>{const s=e.find(a=>a.name===i),n=s==null?void 0:s.type,o=t[i];return n&&!r.includes(n)?Ut(n,o):He(o)},Ut=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return Ur(e,t)}switch(i){case S.bool:return Ir(e);case S.float4:case S.float8:case S.int2:case S.int4:case S.int8:case S.numeric:case S.oid:return Br(e);case S.json:case S.jsonb:return Dr(e);case S.timestamp:return Nr(e);case S.abstime:case S.date:case S.daterange:case S.int4range:case S.int8range:case S.money:case S.reltime:case S.text:case S.time:case S.timestamptz:case S.timetz:case S.tsrange:case S.tstzrange:return He(e);default:return He(e)}},He=i=>i,Ir=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Br=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Dr=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Ur=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let n;const o=i.slice(1,t);try{n=JSON.parse("["+o+"]")}catch(a){n=o?o.split(","):[]}return n.map(a=>Ut(e,a))}return i},Nr=i=>typeof i=="string"?i.replace(" ","T"):i,Nt=i=>{const e=new URL(i);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Re{constructor(e,t,r={},s=Ve){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var gt;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(gt||(gt={}));class ce{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ce.syncState(this.state,s,n,o),this.pendingDiffs.forEach(l=>{this.state=ce.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=ce.syncDiff(this.state,s,n,o),a())}),this.onJoin((s,n,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:o})}),this.onLeave((s,n,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const p=n[c];if(p){const g=u.map(m=>m.presence_ref),v=p.map(m=>m.presence_ref),b=u.filter(m=>v.indexOf(m.presence_ref)<0),_=p.filter(m=>g.indexOf(m.presence_ref)<0);b.length>0&&(a[c]=b),_.length>0&&(l[c]=_)}else a[c]=u}),this.syncDiff(n,{joins:a,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const p=e[a].map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0);e[a].unshift(...g)}r(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(p=>p.presence_ref);c=c.filter(p=>u.indexOf(p.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vt;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(vt||(vt={}));var he;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(he||(he={}));var W;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(W||(W={}));class Ze{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=A.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Re(this,H.join,this.params,this.timeout),this.rejoinTimer=new Dt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=A.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=A.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this._on(H.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ce(this),this.broadcastEndpointURL=Nt(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==A.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(v=>v.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[he.PRESENCE]&&this.bindings[he.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,p={},g={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(v=>e==null?void 0:e(W.CHANNEL_ERROR,v)),this._onClose(()=>e==null?void 0:e(W.CLOSED)),this.updateJoinPayload(Object.assign({config:g},p)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",b=>d(this,[b],function*({postgres_changes:v}){var _;if(this.socket.setAuth(),v===void 0){e==null||e(W.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,P=(_=m==null?void 0:m.length)!==null&&_!==void 0?_:0,C=[];for(let I=0;I<P;I++){const F=m[I],{filter:{event:q,schema:ge,table:je,filter:Ae}}=F,B=v&&v[I];if(B&&B.event===q&&B.schema===ge&&B.table===je&&B.filter===Ae)C.push(Object.assign(Object.assign({},F),{id:B.id}));else{this.unsubscribe(),this.state=A.errored,e==null||e(W.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,e&&e(W.SUBSCRIBED);return}})).receive("error",v=>{this.state=A.errored,e==null||e(W.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(W.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return d(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return d(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this.state===A.joined&&e===he.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}httpSend(s,n){return d(this,arguments,function*(e,t,r={}){var o;const a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const l={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},c=yield this._fetchWithTimeout(this.broadcastEndpointURL,l,(o=r.timeout)!==null&&o!==void 0?o:this.timeout);if(c.status===202)return{success:!0};let u=c.statusText;try{const p=yield c.json();u=p.error||p.message||u}catch(p){}return Promise.reject(new Error(u))})}send(r){return d(this,arguments,function*(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{const u=yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return yield(n=u.body)===null||n===void 0?void 0:n.cancel(),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=A.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(H.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Re(this,H.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=A.closed,this.bindings={}}_fetchWithTimeout(e,t,r){return d(this,null,function*(){const s=new AbortController,n=setTimeout(()=>s.abort(),r),o=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),o})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Re(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Cr){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=H;if(r&&[a,l,c,u].indexOf(o)>=0&&r!==this._joinRef())return;let g=this._onMessage(o,t,r);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(v=>{var b,_,m;return((b=v.filter)===null||b===void 0?void 0:b.event)==="*"||((m=(_=v.filter)===null||_===void 0?void 0:_.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(v=>v.callback(g,r)):(n=this.bindings[o])===null||n===void 0||n.filter(v=>{var b,_,m,P,C,I;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const F=v.id,q=(b=v.filter)===null||b===void 0?void 0:b.event;return F&&((_=t.ids)===null||_===void 0?void 0:_.includes(F))&&(q==="*"||(q==null?void 0:q.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const F=(C=(P=v==null?void 0:v.filter)===null||P===void 0?void 0:P.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return F==="*"||F===((I=t==null?void 0:t.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof g=="object"&&"ids"in g){const b=g.data,{schema:_,table:m,commit_timestamp:P,type:C,errors:I}=b;g=Object.assign(Object.assign({},{schema:_,table:m,commit_timestamp:P,eventType:C,new:{},old:{},errors:I}),this._getPayloadRecords(b))}v.callback(g,r)})}_isClosed(){return this.state===A.closed}_isJoined(){return this.state===A.joined}_isJoining(){return this.state===A.joining}_isLeaving(){return this.state===A.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&Ze.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(H.close,{},e)}_onError(e){this._on(H.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=A.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=pt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=pt(e.columns,e.old_record)),t}}const Ie=()=>{},_e={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Lr=[1e3,2e3,5e3,1e4],Fr=1e4,Vr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Mr{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ve,this.transport=null,this.heartbeatIntervalMs=_e.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ie,this.ref=0,this.reconnectTimer=null,this.logger=Ie,this.conn=null,this.sendBuffer=[],this.serializer=new xr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let n;return s?n=s:typeof fetch=="undefined"?n=(...o)=>te(()=>Promise.resolve().then(()=>re),void 0).then(({default:a})=>a(...o)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):n=fetch,(...o)=>n(...o)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Me.websocket}`,this.httpEndpoint=Nt(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Sr.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:jr}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return d(this,null,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return d(this,null,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case le.connecting:return X.Connecting;case le.open:return X.Open;case le.closing:return X.Closing;default:return X.Closed}}isConnected(){return this.connectionState()===X.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(n=>n.topic===r);if(s)return s;{const n=new Ze(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e=null){return d(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return d(this,null,function*(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Ar,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},_e.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:n,ref:o}=t,a=o?`(${o})`:"",l=n.status||"";this.log("receive",`${l} ${r} ${s} ${a}`.trim(),n),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(s,n,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(H.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Vr],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(e=null){return d(this,null,function*(){let t;e?t=e:this.accessToken?t=yield this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:$r};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(H.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return d(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Dt(()=>d(this,null,function*(){setTimeout(()=>d(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),_e.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,o,a,l,c,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Ve,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:_e.HEARTBEAT_INTERVAL,this.worker=(n=e==null?void 0:e.worker)!==null&&n!==void 0?n:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Ie,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:p=>Lr[p-1]||Fr,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(p,g)=>g(JSON.stringify(p)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window!="undefined"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class et extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function j(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Hr extends et{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class qe extends et{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const tt=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>te(()=>Promise.resolve().then(()=>re),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},qr=()=>y(void 0,void 0,void 0,function*(){return typeof Response=="undefined"?(yield te(()=>Promise.resolve().then(()=>re),void 0)).Response:Response}),Je=i=>{if(Array.isArray(i))return i.map(t=>Je(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[s]=Je(r)}),e},Jr=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Be=i=>{var e;return i.msg||i.message||i.error_description||(typeof i.error=="string"?i.error:(e=i.error)===null||e===void 0?void 0:e.message)||JSON.stringify(i)},zr=(i,e,t)=>y(void 0,void 0,void 0,function*(){const r=yield qr();i instanceof r&&!(t!=null&&t.noResolveJson)?i.json().then(s=>{const n=i.status||500,o=(s==null?void 0:s.statusCode)||n+"";e(new Hr(Be(s),n,o))}).catch(s=>{e(new qe(Be(s),s))}):e(new qe(Be(i),i))}),Wr=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!r?s:(Jr(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function pe(i,e,t,r,s,n){return y(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,Wr(e,r,s,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>zr(l,a,r))})})}function ue(i,e,t,r){return y(this,void 0,void 0,function*(){return pe(i,"GET",e,t,r)})}function M(i,e,t,r,s){return y(this,void 0,void 0,function*(){return pe(i,"POST",e,r,s,t)})}function ze(i,e,t,r,s){return y(this,void 0,void 0,function*(){return pe(i,"PUT",e,r,s,t)})}function Kr(i,e,t,r){return y(this,void 0,void 0,function*(){return pe(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function rt(i,e,t,r,s){return y(this,void 0,void 0,function*(){return pe(i,"DELETE",e,r,s,t)})}class Gr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return y(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(j(e))return{data:null,error:e};throw e}})}}var Lt;class Qr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Lt]="BlobDownloadBuilder",this.promise=null}asStream(){return new Gr(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return y(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(j(e))return{data:null,error:e};throw e}})}}Lt=Symbol.toStringTag;const Xr=Qr,Yr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_t={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Zr{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=tt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return y(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},_t),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob!="undefined"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),p=yield(e=="PUT"?ze:M)(this.fetch,`${this.url}/object/${u}`,n,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:p.Id,fullPath:p.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(j(n))return{data:null,error:n};throw n}})}upload(e,t,r){return y(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return y(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:_t.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob!="undefined"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const p=yield ze(this.fetch,a.toString(),l,{headers:u});return{data:{path:n,fullPath:p.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(j(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return y(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const n=yield M(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new et("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(j(r))return{data:null,error:r};throw r}})}update(e,t,r){return y(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return y(this,void 0,void 0,function*(){try{return{data:yield M(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}copy(e,t,r){return y(this,void 0,void 0,function*(){try{return{data:{path:(yield M(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return y(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield M(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return y(this,void 0,void 0,function*(){try{const s=yield M(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}download(e,t){const s=typeof(t==null?void 0:t.transform)!="undefined"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"",a=this._getFinalPath(e),l=()=>ue(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new Xr(l,this.shouldThrowOnError)}info(e){return y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield ue(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Je(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(j(r))return{data:null,error:r};throw r}})}exists(e){return y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Kr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(j(r)&&r instanceof qe){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&s.push(n);const a=typeof(t==null?void 0:t.transform)!="undefined"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return y(this,void 0,void 0,function*(){try{return{data:yield rt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}list(e,t,r){return y(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Yr),t),{prefix:e||""});return{data:yield M(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}listV2(e,t){return y(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield M(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(j(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer!="undefined"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ft="2.78.0",Vt={"X-Client-Info":`storage-js/${Ft}`};class es{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Vt),t),this.fetch=tt(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return y(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield ue(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}getBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield ue(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}createBucket(e){return y(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield M(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(j(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return y(this,void 0,void 0,function*(){try{return{data:yield ze(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(j(r))return{data:null,error:r};throw r}})}emptyBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield M(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}deleteBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield rt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class ts{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Vt),t),this.fetch=tt(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield M(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}listBuckets(e){return y(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const r=t.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield ue(this.fetch,s,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}deleteBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield rt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(j(t))return{data:null,error:t};throw t}})}}const st={"X-Client-Info":`storage-js/${Ft}`,"Content-Type":"application/json"};class Mt extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function N(i){return typeof i=="object"&&i!==null&&"__isStorageVectorsError"in i}class De extends Mt{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class rs extends Mt{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var yt;(function(i){i.InternalError="InternalError",i.S3VectorConflictException="S3VectorConflictException",i.S3VectorNotFoundException="S3VectorNotFoundException",i.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",i.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",i.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(yt||(yt={}));const it=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>te(()=>Promise.resolve().then(()=>re),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ss=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},mt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),is=(i,e,t)=>y(void 0,void 0,void 0,function*(){if(i&&typeof i=="object"&&"status"in i&&"ok"in i&&typeof i.status=="number"&&!(t!=null&&t.noResolveJson)){const s=i.status||500,n=i;if(typeof n.json=="function")n.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||s+"";e(new De(mt(o),s,a))}).catch(()=>{const o=s+"",a=n.statusText||`HTTP ${s} error`;e(new De(a,s,o))});else{const o=s+"",a=n.statusText||`HTTP ${s} error`;e(new De(a,s,o))}}else e(new rs(mt(i),i))}),ns=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!r?s:(ss(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Object.assign(Object.assign({},s),t))};function os(i,e,t,r,s,n){return y(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,ns(e,r,s,n)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>is(l,a,r))})})}function L(i,e,t,r,s){return y(this,void 0,void 0,function*(){return os(i,"POST",e,r,s,t)})}class as{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},st),t),this.fetch=it(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return y(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}getIndex(e,t){return y(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(N(r))return{data:null,error:r};throw r}})}listIndexes(e){return y(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return y(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(N(r))return{data:null,error:r};throw r}})}}class ls{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},st),t),this.fetch=it(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return y(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield L(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}getVectors(e){return y(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}listVectors(e){return y(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield L(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}queryVectors(e){return y(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}deleteVectors(e){return y(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield L(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}}class cs{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},st),t),this.fetch=it(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return y(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}getBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}listBuckets(){return y(this,arguments,void 0,function*(e={}){try{return{data:yield L(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}deleteBucket(e){return y(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(N(t))return{data:null,error:t};throw t}})}}class hs extends cs{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new us(this.url,this.headers,e,this.fetch)}}class us extends as{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return y(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return y(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return y(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return y(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new ds(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class ds extends ls{constructor(e,t,r,s,n){super(e,t,n),this.vectorBucketName=r,this.indexName=s}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return y(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return y(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return y(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return y(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return y(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class fs extends es{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Zr(this.url,this.headers,e,this.fetch)}get vectors(){return new hs(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ts(this.url+"/iceberg",this.headers,this.fetch)}}const ps="2.30.0",gs={"X-Client-Info":`supabase-js/${ps}`};var We={exports:{}};(function(i,e){var t=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof R!="undefined"&&R,r=function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n}();(function(n){(function(o){var a=typeof n!="undefined"&&n||typeof self!="undefined"&&self||typeof R!="undefined"&&R||{},l={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(h){return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function c(h){return h&&DataView.prototype.isPrototypeOf(h)}if(l.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=ArrayBuffer.isView||function(h){return h&&u.indexOf(Object.prototype.toString.call(h))>-1};function g(h){if(typeof h!="string"&&(h=String(h)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(h)||h==="")throw new TypeError('Invalid character in header field name: "'+h+'"');return h.toLowerCase()}function v(h){return typeof h!="string"&&(h=String(h)),h}function b(h){var f={next:function(){var w=h.shift();return{done:w===void 0,value:w}}};return l.iterable&&(f[Symbol.iterator]=function(){return f}),f}function _(h){this.map={},h instanceof _?h.forEach(function(f,w){this.append(w,f)},this):Array.isArray(h)?h.forEach(function(f){if(f.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+f.length);this.append(f[0],f[1])},this):h&&Object.getOwnPropertyNames(h).forEach(function(f){this.append(f,h[f])},this)}_.prototype.append=function(h,f){h=g(h),f=v(f);var w=this.map[h];this.map[h]=w?w+", "+f:f},_.prototype.delete=function(h){delete this.map[g(h)]},_.prototype.get=function(h){return h=g(h),this.has(h)?this.map[h]:null},_.prototype.has=function(h){return this.map.hasOwnProperty(g(h))},_.prototype.set=function(h,f){this.map[g(h)]=v(f)},_.prototype.forEach=function(h,f){for(var w in this.map)this.map.hasOwnProperty(w)&&h.call(f,this.map[w],w,this)},_.prototype.keys=function(){var h=[];return this.forEach(function(f,w){h.push(w)}),b(h)},_.prototype.values=function(){var h=[];return this.forEach(function(f){h.push(f)}),b(h)},_.prototype.entries=function(){var h=[];return this.forEach(function(f,w){h.push([w,f])}),b(h)},l.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function m(h){if(!h._noBody){if(h.bodyUsed)return Promise.reject(new TypeError("Already read"));h.bodyUsed=!0}}function P(h){return new Promise(function(f,w){h.onload=function(){f(h.result)},h.onerror=function(){w(h.error)}})}function C(h){var f=new FileReader,w=P(f);return f.readAsArrayBuffer(h),w}function I(h){var f=new FileReader,w=P(f),k=/charset=([A-Za-z0-9_-]+)/.exec(h.type),$=k?k[1]:"utf-8";return f.readAsText(h,$),w}function F(h){for(var f=new Uint8Array(h),w=new Array(f.length),k=0;k<f.length;k++)w[k]=String.fromCharCode(f[k]);return w.join("")}function q(h){if(h.slice)return h.slice(0);var f=new Uint8Array(h.byteLength);return f.set(new Uint8Array(h)),f.buffer}function ge(){return this.bodyUsed=!1,this._initBody=function(h){this.bodyUsed=this.bodyUsed,this._bodyInit=h,h?typeof h=="string"?this._bodyText=h:l.blob&&Blob.prototype.isPrototypeOf(h)?this._bodyBlob=h:l.formData&&FormData.prototype.isPrototypeOf(h)?this._bodyFormData=h:l.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)?this._bodyText=h.toString():l.arrayBuffer&&l.blob&&c(h)?(this._bodyArrayBuffer=q(h.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):l.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(h)||p(h))?this._bodyArrayBuffer=q(h):this._bodyText=h=Object.prototype.toString.call(h):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof h=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):l.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},l.blob&&(this.blob=function(){var h=m(this);if(h)return h;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var h=m(this);return h||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(l.blob)return this.blob().then(C);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var h=m(this);if(h)return h;if(this._bodyBlob)return I(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(F(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},l.formData&&(this.formData=function(){return this.text().then(zt)}),this.json=function(){return this.text().then(JSON.parse)},this}var je=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Ae(h){var f=h.toUpperCase();return je.indexOf(f)>-1?f:h}function B(h,f){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');f=f||{};var w=f.body;if(h instanceof B){if(h.bodyUsed)throw new TypeError("Already read");this.url=h.url,this.credentials=h.credentials,f.headers||(this.headers=new _(h.headers)),this.method=h.method,this.mode=h.mode,this.signal=h.signal,!w&&h._bodyInit!=null&&(w=h._bodyInit,h.bodyUsed=!0)}else this.url=String(h);if(this.credentials=f.credentials||this.credentials||"same-origin",(f.headers||!this.headers)&&(this.headers=new _(f.headers)),this.method=Ae(f.method||this.method||"GET"),this.mode=f.mode||this.mode||null,this.signal=f.signal||this.signal||function(){if("AbortController"in a){var E=new AbortController;return E.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(w),(this.method==="GET"||this.method==="HEAD")&&(f.cache==="no-store"||f.cache==="no-cache")){var k=/([?&])_=[^&]*/;if(k.test(this.url))this.url=this.url.replace(k,"$1_="+new Date().getTime());else{var $=/\?/;this.url+=($.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}B.prototype.clone=function(){return new B(this,{body:this._bodyInit})};function zt(h){var f=new FormData;return h.trim().split("&").forEach(function(w){if(w){var k=w.split("="),$=k.shift().replace(/\+/g," "),E=k.join("=").replace(/\+/g," ");f.append(decodeURIComponent($),decodeURIComponent(E))}}),f}function Wt(h){var f=new _,w=h.replace(/\r?\n[\t ]+/g," ");return w.split("\r").map(function(k){return k.indexOf(`
`)===0?k.substr(1,k.length):k}).forEach(function(k){var $=k.split(":"),E=$.shift().trim();if(E){var ve=$.join(":").trim();try{f.append(E,ve)}catch(xe){console.warn("Response "+xe.message)}}}),f}ge.call(B.prototype);function V(h,f){if(!(this instanceof V))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(f||(f={}),this.type="default",this.status=f.status===void 0?200:f.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=f.statusText===void 0?"":""+f.statusText,this.headers=new _(f.headers),this.url=f.url||"",this._initBody(h)}ge.call(V.prototype),V.prototype.clone=function(){return new V(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},V.error=function(){var h=new V(null,{status:200,statusText:""});return h.ok=!1,h.status=0,h.type="error",h};var Kt=[301,302,303,307,308];V.redirect=function(h,f){if(Kt.indexOf(f)===-1)throw new RangeError("Invalid status code");return new V(null,{status:f,headers:{location:h}})},o.DOMException=a.DOMException;try{new o.DOMException}catch(h){o.DOMException=function(f,w){this.message=f,this.name=w;var k=Error(f);this.stack=k.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function Ce(h,f){return new Promise(function(w,k){var $=new B(h,f);if($.signal&&$.signal.aborted)return k(new o.DOMException("Aborted","AbortError"));var E=new XMLHttpRequest;function ve(){E.abort()}E.onload=function(){var x={statusText:E.statusText,headers:Wt(E.getAllResponseHeaders()||"")};$.url.indexOf("file://")===0&&(E.status<200||E.status>599)?x.status=200:x.status=E.status,x.url="responseURL"in E?E.responseURL:x.headers.get("X-Request-URL");var G="response"in E?E.response:E.responseText;setTimeout(function(){w(new V(G,x))},0)},E.onerror=function(){setTimeout(function(){k(new TypeError("Network request failed"))},0)},E.ontimeout=function(){setTimeout(function(){k(new TypeError("Network request timed out"))},0)},E.onabort=function(){setTimeout(function(){k(new o.DOMException("Aborted","AbortError"))},0)};function xe(x){try{return x===""&&a.location.href?a.location.href:x}catch(G){return x}}if(E.open($.method,xe($.url),!0),$.credentials==="include"?E.withCredentials=!0:$.credentials==="omit"&&(E.withCredentials=!1),"responseType"in E&&(l.blob?E.responseType="blob":l.arrayBuffer&&(E.responseType="arraybuffer")),f&&typeof f.headers=="object"&&!(f.headers instanceof _||a.Headers&&f.headers instanceof a.Headers)){var lt=[];Object.getOwnPropertyNames(f.headers).forEach(function(x){lt.push(g(x)),E.setRequestHeader(x,v(f.headers[x]))}),$.headers.forEach(function(x,G){lt.indexOf(G)===-1&&E.setRequestHeader(G,x)})}else $.headers.forEach(function(x,G){E.setRequestHeader(G,x)});$.signal&&($.signal.addEventListener("abort",ve),E.onreadystatechange=function(){E.readyState===4&&$.signal.removeEventListener("abort",ve)}),E.send(typeof $._bodyInit=="undefined"?null:$._bodyInit)})}return Ce.polyfill=!0,a.fetch||(a.fetch=Ce,a.Headers=_,a.Request=B,a.Response=V),o.Headers=_,o.Request=B,o.Response=V,o.fetch=Ce,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=t.fetch?t:r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,i.exports=e})(We,We.exports);var nt=We.exports;const Ht=Qt(nt),vs=Xt({__proto__:null,default:Ht},[nt]);var _s=globalThis&&globalThis.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(p){o(p)}}function l(u){try{c(r.throw(u))}catch(p){o(p)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const ys=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=Ht:e=fetch,(...t)=>e(...t)},ms=()=>typeof Headers=="undefined"?nt.Headers:Headers,ws=(i,e,t)=>{const r=ys(t),s=ms();return(n,o)=>_s(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:i;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:c}))})};function bs(i){return i.replace(/\/$/,"")}function Es(i,e){const{db:t,auth:r,realtime:s,global:n}=i,{db:o,auth:a,realtime:l,global:c}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),n)}}function Ts(i){return Math.round(Date.now()/1e3)+i}function Os(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const z=()=>typeof document!="undefined",Q={tested:!1,writable:!1},Te=()=>{if(!z())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch(e){return!1}if(Q.tested)return Q.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Q.tested=!0,Q.writable=!0}catch(e){Q.tested=!0,Q.writable=!1}return Q.writable};function D(i,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),i=i.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+i+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const qt=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>d(void 0,null,function*(){return yield(yield te(()=>Promise.resolve().then(()=>vs),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},ks=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",oe=(i,e,t)=>d(void 0,null,function*(){yield i.setItem(e,JSON.stringify(t))}),ye=(i,e)=>d(void 0,null,function*(){const t=yield i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(r){return t}}),Ue=(i,e)=>d(void 0,null,function*(){yield i.removeItem(e)});function Ss(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,n,o,a,l,c,u=0;for(i=i.replace("-","+").replace("_","/");u<i.length;)o=e.indexOf(i.charAt(u++)),a=e.indexOf(i.charAt(u++)),l=e.indexOf(i.charAt(u++)),c=e.indexOf(i.charAt(u++)),r=o<<2|a>>4,s=(a&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(r),l!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class $e{constructor(){this.promise=new $e.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}$e.promiseConstructor=Promise;function wt(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Ss(r))}function Ps(i){return new Promise(e=>{setTimeout(()=>e(null),i)})}function $s(i,e){return new Promise((r,s)=>{d(this,null,function*(){for(let n=0;n<1/0;n++)try{const o=yield i(n);if(!e(n,null,o)){r(o);return}}catch(o){if(!e(n,o)){s(o);return}}})})}function js(i){return("0"+i.toString(16)).substr(-2)}function me(){const e=new Uint32Array(56);if(typeof crypto=="undefined"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,js).join("")}function As(i){return d(this,null,function*(){const t=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")})}function Cs(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function we(i){return d(this,null,function*(){if(typeof crypto=="undefined")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const e=yield As(i);return Cs(e)})}const xs="__stack_guard__",Rs="__",Is=/__stack_guard__([a-zA-Z0-9_-]+)__/;let bt=!1,ot;function Ke(i){var e,t;ot();let r;try{throw new Error}catch(n){r=n}const s=(t=(e=r.stack)===null||e===void 0?void 0:e.split(`
`))!==null&&t!==void 0?t:[];for(let n=0;n<s.length;n+=1){const a=s[n].match(Is);if(a&&a[1]===i)return!0}return!1}function Ge(i,e){return d(this,null,function*(){yield ot();const t=`${xs}${i}${Rs}`;return yield{[t]:()=>d(this,null,function*(){return yield e()})}[t]()})}ot=()=>d(void 0,null,function*(){bt||(bt=!0,yield Ge("ENV_CHECK",()=>d(void 0,null,function*(){const i=Ke("ENV_CHECK");return i||console.warn("@supabase/gotrue-js: Stack guards not supported in this environment. Generally not an issue but may point to a very conservative transpilation environment (use ES2017 or above) that implements async/await with generators, or this is a JavaScript engine that does not support async/await stack traces."),i})))});class at extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function T(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class Bs extends at{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Ds(i){return T(i)&&i.name==="AuthApiError"}class Jt extends at{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ie extends at{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Z extends ie{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Ne extends ie{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class be extends ie{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class J extends ie{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Le extends ie{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qe extends ie{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Et(i){return T(i)&&i.name==="AuthRetryableFetchError"}var Us=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};const ae=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Ns=[502,503,504];function Tt(i){return d(this,null,function*(){if(!ks(i))throw new Qe(ae(i),0);if(Ns.includes(i.status))throw new Qe(ae(i),i.status);let e;try{e=yield i.json()}catch(t){throw new Jt(ae(t),t)}throw new Bs(ae(e),i.status||500)})}const Ls=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function O(i,e,t,r){return d(this,null,function*(){var s;const n=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield Fs(i,e,t+a,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}})}function Fs(i,e,t,r,s,n){return d(this,null,function*(){const o=Ls(e,r,s,n);let a;try{a=yield i(t,o)}catch(l){throw console.error(l),new Qe(ae(l),0)}if(a.ok||(yield Tt(a)),r!=null&&r.noResolveJson)return a;try{return yield a.json()}catch(l){yield Tt(l)}})}function K(i){var e;let t=null;qs(i)&&(t=Object.assign({},i),t.expires_at=Ts(i.expires_in));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function Y(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Vs(i){return{data:i,error:null}}function Ms(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n}=i,o=Us(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Hs(i){return i}function qs(i){return i.access_token&&i.refresh_token&&i.expires_in}var Js=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};class zs{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=qt(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return d(this,null,function*(){try{return yield O(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(T(r))return{data:null,error:r};throw r}})}inviteUserByEmail(r){return d(this,arguments,function*(e,t={}){try{return yield O(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Y})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return d(this,null,function*(){try{const{options:t}=e,r=Js(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield O(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ms,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return d(this,null,function*(){try{return yield O(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Y})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return d(this,null,function*(){var t,r,s,n,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=yield O(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Hs});if(u.error)throw u.error;const p=yield u.json(),g=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return v.length>0&&(v.forEach(b=>{const _=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(b.split(";")[1].split("=")[1]);c[`${m}Page`]=_}),c.total=parseInt(g)),{data:Object.assign(Object.assign({},p),c),error:null}}catch(c){if(T(c))return{data:{users:[]},error:c};throw c}})}getUserById(e){return d(this,null,function*(){try{return yield O(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Y})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return d(this,null,function*(){try{return yield O(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Y})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return d(this,null,function*(){try{return yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Y})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return d(this,null,function*(){try{const{data:t,error:r}=yield O(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(T(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return d(this,null,function*(){try{return{data:yield O(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}}const Ws="2.43.1",Ks="http://localhost:9999",Gs="supabase.auth.token",Qs={"X-Client-Info":`gotrue-js/${Ws}`},Ot=10,kt={getItem:i=>Te()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Te()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Te()&&globalThis.localStorage.removeItem(i)}};function Xs(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(i){typeof self!="undefined"&&(self.globalThis=self)}}Xs();const Ys={url:Ks,storageKey:Gs,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Qs,flowType:"implicit",debug:!1},Ee=30*1e3,St=3;class de{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=de.nextInstanceID,de.nextInstanceID+=1,this.instanceID>0&&z()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Ys),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||kt,this.admin=new zs({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=qt(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===kt&&!Te()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),z()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>d(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise?this.initializePromise:this._initialize()}_initialize(){return d(this,null,function*(){if(this.initializePromise)throw new Error("Double call of #_initialize()");return this.initializePromise=Ge("_initialize",()=>d(this,null,function*(){try{const e=z()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),yield this._saveSession(s),setTimeout(()=>d(this,null,function*(){n==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return T(e)?{error:e}:{error:new Jt("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})),yield this.initializePromise})}signUp(e){return d(this,null,function*(){var t,r,s;try{yield this._removeSession();let n;if("email"in e){const{email:u,password:p,options:g}=e;let v=null,b=null;if(this.flowType==="pkce"){const _=me();yield oe(this.storage,`${this.storageKey}-code-verifier`,_),v=yield we(_),b=_===v?"plain":"s256"}n=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:u,password:p,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:v,code_challenge_method:b},xform:K})}else if("phone"in e){const{phone:u,password:p,options:g}=e;n=yield O(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:p,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(s=g==null?void 0:g.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:K})}else throw new be("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(T(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithPassword(e){return d(this,null,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:n,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:K})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=yield O(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:K})}else throw new be("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ne}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return d(this,null,function*(){var t,r,s,n;return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})})}exchangeCodeForSession(e){return d(this,null,function*(){const t=yield ye(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield O(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:K});return yield Ue(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ne}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return d(this,null,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,access_token:n,nonce:o}=e,a=yield O(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:K}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ne}:(l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return d(this,null,function*(){var t,r,s,n,o;try{if(yield this._removeSession(),"email"in e){const{email:a,options:l}=e;let c=null,u=null;if(this.flowType==="pkce"){const g=me();yield oe(this.storage,`${this.storageKey}-code-verifier`,g),c=yield we(g),u=g===c?"plain":"s256"}const{error:p}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=yield O(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new be("You must provide either an email or phone number.")}catch(a){if(T(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){return d(this,null,function*(){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:s,error:n}=yield O(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:K});if(n)throw n;if(!s)throw new Error("An error occurred on token verification.");const o=s.session,a=s.user;return o!=null&&o.access_token&&(yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(s){if(T(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){return d(this,null,function*(){var t,r,s;try{return yield this._removeSession(),yield O(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:Vs})}catch(n){if(T(n))return{data:null,error:n};throw n}})}reauthenticate(){return d(this,null,function*(){try{return yield this._useSession(e=>d(this,null,function*(){const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Z;const{error:s}=yield O(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return d(this,null,function*(){try{e.type!="email_change"&&e.type!="phone_change"&&(yield this._removeSession());const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:o}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:o,error:a}=yield O(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new be("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return d(this,null,function*(){return this._useSession(e=>d(this,null,function*(){return e}))})}_useSession(e){return d(this,null,function*(){return yield Ge("_useSession",()=>d(this,null,function*(){const t=yield this.__loadSession();return yield e(t)}))})}__loadSession(){return d(this,null,function*(){if(this._debug("#__loadSession()","begin"),this.logDebugMessages&&!Ke("_useSession"))throw new Error("Please use #_useSession()");Ke("_initialize")||(yield this.initializePromise);try{let e=null;if(this.persistSession){const n=yield ye(this.storage,this.storageKey);this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r,s;if(!e){const{data:n,error:o}=t;if(o)throw o;e=(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0}return yield O(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Y})}))}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}updateUser(r){return d(this,arguments,function*(e,t={}){try{return yield this._useSession(s=>d(this,null,function*(){const{data:n,error:o}=s;if(o)throw o;if(!n.session)throw new Z;const a=n.session,{data:l,error:c}=yield O(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:a.access_token,xform:Y});if(c)throw c;return a.user=l.user,yield this._saveSession(a),yield this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}}))}catch(s){if(T(s))return{data:{user:null},error:s};throw s}})}_decodeJWT(e){return wt(e)}setSession(e){return d(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Z;const t=Date.now()/1e3;let r=t,s=!0,n=null;const o=wt(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:l}=yield this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=yield this.getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Z;const{session:s,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromUrl(e){return d(this,null,function*(){try{if(!z())throw new J("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new J("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Le("Not a valid PKCE flow url.");if(e){const m=D("code");if(!m)throw new Le("No code detected.");const{data:P,error:C}=yield this.exchangeCodeForSession(m);if(C)throw C;if(!P.session)throw new Le("No session detected.");let I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:P.session,redirectType:null},error:null}}const t=D("error_description");if(t){const m=D("error_code");if(!m)throw new J("No error_code detected.");const P=D("error");throw P?new J(t,{error:P,code:m}):new J("No error detected.")}const r=D("provider_token"),s=D("provider_refresh_token"),n=D("access_token");if(!n)throw new J("No access_token detected.");const o=D("expires_in");if(!o)throw new J("No expires_in detected.");const a=D("refresh_token");if(!a)throw new J("No refresh_token detected.");const l=D("token_type");if(!l)throw new J("No token_type detected.");const u=Math.round(Date.now()/1e3)+parseInt(o),{data:p,error:g}=yield this.getUser(n);if(g)throw g;const v=p.user,b={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:parseInt(o),expires_at:u,refresh_token:a,token_type:l,user:v},_=D("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:b,redirectType:_},error:null}}catch(t){if(T(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return z()&&(!!D("access_token")||!!D("error_description"))}_isPKCEFlow(){return d(this,null,function*(){const e=yield ye(this.storage,`${this.storageKey}-code-verifier`);return!!D("code")&&!!e})}signOut(){return d(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>d(this,null,function*(){var r;const{data:s,error:n}=t;if(n)return{error:n};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=yield this.admin.signOut(o,e);if(a&&!(Ds(a)&&(a.status===404||a.status===401)))return{error:a}}return e!=="others"&&(yield this._removeSession(),yield Ue(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))})}onAuthStateChange(e){const t=Os(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){return d(this,null,function*(){return yield this._useSession(t=>d(this,null,function*(){var r,s;try{const{data:{session:n},error:o}=t;if(o)throw o;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){yield(s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}}))})}resetPasswordForEmail(r){return d(this,arguments,function*(e,t={}){let s=null,n=null;if(this.flowType==="pkce"){const o=me();yield oe(this.storage,`${this.storageKey}-code-verifier`,o),s=yield we(o),n=o===s?"plain":"s256"}try{return yield O(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(T(o))return{data:null,error:o};throw o}})}_refreshAccessToken(e){return d(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield $s(s=>d(this,null,function*(){return yield Ps(s*200),this._debug(t,"refreshing attempt",s),yield O(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:K})}),(s,n,o)=>o&&o.error&&Et(o.error)&&Date.now()+(s+1)*200-r<Ee)}catch(r){if(this._debug(t,"error",r),T(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return d(this,null,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),z()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return d(this,null,function*(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield ye(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&(yield this._removeSession());return}const s=Math.round(Date.now()/1e3),n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+Ot;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Ot}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=yield this._callRefreshToken(r.refresh_token);o&&(console.error(o),Et(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}})}_callRefreshToken(e){return d(this,null,function*(){var t,r;if(!e)throw new Z;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new $e;const{data:n,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new Z;yield this._saveSession(n.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(s,"error",n),T(n)){const o={session:null,error:n};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}})}_notifyAllSubscribers(e,t,r=!0){return d(this,null,function*(){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(a=>d(this,null,function*(){try{yield a.callback(e,t)}catch(l){n.push(l)}}));if(yield Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(s,"end")}})}_saveSession(e){return d(this,null,function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return this._debug("#_persistSession()",e),oe(this.storage,this.storageKey,e)}_removeSession(){return d(this,null,function*(){this._debug("#_removeSession()"),this.persistSession?yield Ue(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&z()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return d(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ee);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno!="undefined"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return d(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return d(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return d(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return d(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{return yield this._useSession(t=>d(this,null,function*(){const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ee);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ee}ms, refresh threshold is ${St} ticks`),s<=St&&(yield this._callRefreshToken(r.refresh_token))}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}_handleVisibilityChange(){return d(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!z()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>d(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return d(this,null,function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return d(this,null,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=me();yield oe(this.storage,`${this.storageKey}-code-verifier`,s);const n=yield we(s),o=s===n?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",n,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r;const{data:s,error:n}=t;return n?{data:null,error:n}:yield O(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(T(t))return{data:null,error:t};throw t}})}_enroll(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r,s;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=yield O(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(T(t))return{data:null,error:t};throw t}})}_verify(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})}))}catch(t){if(T(t))return{data:null,error:t};throw t}})}_challenge(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var r;const{data:s,error:n}=t;return n?{data:null,error:n}:yield O(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(T(t))return{data:null,error:t};throw t}})}_challengeAndVerify(e){return d(this,null,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return d(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){return d(this,null,function*(){return yield this._useSession(e=>d(this,null,function*(){var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(p=>p.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))})}}de.nextInstanceID=0;class Zs extends de{constructor(e){super(e)}}var ei=globalThis&&globalThis.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(p){o(p)}}function l(u){try{c(r.throw(u))}catch(p){o(p)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(i,e||[])).next())})};const ti={headers:gs},ri={schema:"public"},si={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ii={};class ni{constructor(e,t,r){var s,n,o,a,l,c,u,p;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const g=bs(e);this.realtimeUrl=`${g}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${g}/auth/v1`,this.storageUrl=`${g}/storage/v1`,this.functionsUrl=`${g}/functions/v1`;const v=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,b={db:ri,realtime:ii,auth:Object.assign(Object.assign({},si),{storageKey:v}),global:ti},_=Es(r!=null?r:{},b);this.storageKey=(n=(s=_.auth)===null||s===void 0?void 0:s.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=(o=_.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((l=_.auth)!==null&&l!==void 0?l:{},this.headers,(c=_.global)===null||c===void 0?void 0:c.fetch),this.fetch=ws(t,this._getAccessToken.bind(this),(u=_.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new kr(`${g}/rest/v1`,{headers:this.headers,schema:(p=_.db)===null||p===void 0?void 0:p.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new tr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new fs(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ei(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,debug:a},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Zs({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:c})}_initRealtimeClient(e){return new Mr(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r!=null?r:null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const wi=(i,e,t)=>new ni(i,e,t);export{ht as _,li as a,ci as b,wi as c,te as d};
