var f=(l,x,c)=>new Promise((o,n)=>{var g=r=>{try{m(c.next(r))}catch(d){n(d)}},h=r=>{try{m(c.throw(r))}catch(d){n(d)}},m=r=>r.done?o(r.value):Promise.resolve(r.value).then(g,h);m((c=c.apply(l,x)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as p}from"./react-vendor-6cf6ded9.js";import{i as _,C as N,k as v,l as b,w as y,j as w,X as u}from"./index-426aa6f1.js";import{S as L}from"./scroll-area-8a7e81aa.js";import{A,a as E}from"./alert-9353e410.js";import{e as D}from"./licenses-39749db6.js";import{d as S,a7 as R,a$ as T,b7 as k}from"./ui-icons-e73ce4f7.js";function V({trainerId:l}){const[x,c]=p.useState({}),[o,n]=p.useState([]),[g,h]=p.useState(!0),{toast:m}=_();p.useEffect(()=>{l&&r()},[l]);const r=()=>f(this,null,function*(){try{h(!0);const s=yield D(l);if(!s||s.length===0){c({}),n([]);return}const a={};s.forEach(t=>{var j;const i=t.category_id,C=((j=t.category)==null?void 0:j.name)||`Catégorie ${i}`;a[i]={name:C,is_active:t.is_active,expires_at:t.expires_at,created_at:t.created_at}}),c(a),n([])}catch(s){console.error("Erreur lors du chargement des licences:",s),m({title:"Erreur",description:s.message||"Impossible de charger les données",variant:"destructive"}),c({}),n([])}finally{h(!1)}}),d={};return o.forEach(s=>{var a;(a=s.categories)==null||a.forEach(t=>{d[t.categoryId]=(d[t.categoryId]||0)+1})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Résumé des Licences"]}),e.jsx(y,{children:"Aperçu des licences achetées et attribuées par catégorie"})]}),e.jsx(w,{children:g?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Chargement..."}):Object.keys(x).length===0?e.jsxs(A,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(E,{children:`Vous n'avez pas encore de licences. Rendez-vous dans l'onglet "Acheter des licences" pour en acquérir.`})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Object.entries(x).map(([s,a])=>{const t=a.expires_at&&new Date(a.expires_at)<new Date,i=a.is_active&&!t;return e.jsxs("div",{className:`p-4 border rounded-lg space-y-3 ${i?"bg-gradient-to-br from-green-50 to-green-100 border-green-200":"bg-gradient-to-br from-red-50 to-red-100 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:a.name}),e.jsx(u,{className:i?"bg-green-600":"bg-red-600",variant:"default",children:i?"Active":t?"Expirée":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Statut"}),e.jsx("span",{className:"font-medium",children:i?"✓ Active":"✗ Inactive"})]}),a.expires_at&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Expire le"]}),e.jsx("span",{className:"font-medium",children:new Date(a.expires_at).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Créée le"}),e.jsx("span",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString("fr-FR")})]})]})]},s)})})})]}),o.length>0&&e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Licences par Apprenant"]}),e.jsx(y,{children:"Liste détaillée des licences attribuées à chaque apprenant"})]}),e.jsx(w,{children:e.jsx(L,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:o.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-2 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:s.first_name||"Apprenant sans nom"}),e.jsx(u,{variant:"outline",className:"text-xs",children:s.learner_code})]}),s.categories&&s.categories.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.categories.map((a,t)=>e.jsx(u,{className:"text-xs bg-green-600/80",children:a.categoryName},t))}):e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Aucune licence attribuée"})]},s.id))})})})]})]})}export{V as T};
