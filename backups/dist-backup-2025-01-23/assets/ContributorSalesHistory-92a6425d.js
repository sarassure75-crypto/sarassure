var R=Object.defineProperty,$=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var D=(t,a,r)=>a in t?R(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,y=(t,a)=>{for(var r in a||(a={}))T.call(a,r)&&D(t,r,a[r]);if(E)for(var r of E(a))A.call(a,r)&&D(t,r,a[r]);return t},b=(t,a)=>$(t,F(a));var _=(t,a,r)=>new Promise((c,o)=>{var p=l=>{try{i(r.next(l))}catch(x){o(x)}},g=l=>{try{i(r.throw(l))}catch(x){o(x)}},i=l=>l.done?c(l.value):Promise.resolve(l.value).then(p,g);i((r=r.apply(t,a)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as m}from"./react-vendor-6cf6ded9.js";import{u as H}from"./index-426aa6f1.js";import{a as q,b as L,f as h}from"./contributorRevenue-c96552d7.js";import{a9 as P,l as j,a6 as z,I as B,b as G,b1 as J,D as K}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";function U(){const{currentUser:t}=H(),[a,r]=m.useState([]),[c,o]=m.useState([]),[p,g]=m.useState(!0),[i,l]=m.useState("all");m.useEffect(()=>{t!=null&&t.id&&x()},[t==null?void 0:t.id]);const x=()=>_(this,null,function*(){try{g(!0);const[s,n]=yield Promise.all([q(t.id,100),L(t.id,100)]);r(s||[]),o(n||[])}catch(s){console.error("Error loading sales history:",s)}finally{g(!1)}}),d=[...a.map(s=>b(y({},s),{type:"exercise"})),...c.map(s=>b(y({},s),{type:"image"}))].sort((s,n)=>new Date(n.purchase_date)-new Date(s.purchase_date)),u=i==="all"?d:d.filter(s=>i==="exercises"?s.type==="exercise":s.type==="image"),N=d.reduce((s,n)=>s+n.price_cents,0),V=d.length,I=N*.2;return p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Historique des Ventes"}),e.jsx("p",{className:"text-gray-600",children:"Détail de toutes vos ventes et revenus générés"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Ventes totales"}),e.jsx(P,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:V}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[a.length," exercices • ",c.length," images"]})]}),e.jsxs("div",{className:"bg-emerald-50 p-6 rounded-lg shadow border border-emerald-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-emerald-900",children:"Revenus générés"}),e.jsx(j,{className:"w-5 h-5 text-emerald-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-emerald-900",children:h(N)}),e.jsx("p",{className:"text-xs text-emerald-600 mt-2",children:"Revenus bruts"})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg shadow border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-green-900",children:"Vos gains (20%)"}),e.jsx(j,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:h(I)}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"Commission contributeur"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrer:"}),e.jsxs("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Tout (",d.length,")"]}),e.jsxs("button",{onClick:()=>l("exercises"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="exercises"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Exercices (",a.length,")"]}),e.jsxs("button",{onClick:()=>l("images"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="images"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Images (",c.length,")"]})]})}),u.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-12 text-center",children:[e.jsx(j,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucune vente pour le moment"}),e.jsx("p",{className:"text-gray-600",children:"Vos contributions n'ont pas encore été achetées. Continuez à créer du contenu de qualité !"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contenu"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acheteur"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Votre part"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((s,n)=>{var f,w,v,S,C,k;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:s.type==="exercise"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Exercice"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-600",children:"Image"})]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.type==="exercise"?((f=s.task)==null?void 0:f.title)||((w=s.version)==null?void 0:w.name)||"Sans titre":((v=s.image)==null?void 0:v.title)||((S=s.image)==null?void 0:S.name)||"Sans titre"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[(C=s.buyer)==null?void 0:C.first_name," ",(k=s.buyer)==null?void 0:k.last_name]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:new Date(s.purchase_date).toLocaleDateString("fr-FR")})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:h(s.price_cents)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-bold text-green-600",children:h(s.price_cents*.2)})})]},`${s.type}-${s.id}-${n}`)})})]})})}),u.length>0&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:()=>{alert("Export CSV à implémenter")},className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Exporter en CSV"})]})})]})}export{U as default};
