var V=(S,y,i)=>new Promise((o,u)=>{var I=t=>{try{h(i.next(t))}catch(p){u(p)}},N=t=>{try{h(i.throw(t))}catch(p){u(p)}},h=t=>t.done?o(t.value):Promise.resolve(t.value).then(I,N);h((i=i.apply(S,y)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{u as M,f as O,r}from"./react-vendor-6cf6ded9.js";import{i as U,u as Y,aS as L,m as Z,e as Q,C as G,k as K,l as W,w as X,j as ee,Y as f,Z as se,I as te,$ as ae,aT as ne,aU as re}from"./index-426aa6f1.js";import{S as F,a as A,b as R,c as P,d as q}from"./select-6c123d42.js";import{w as ie,e as oe,r as le}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";import"./index-d203b311.js";import"./index-cc17d877.js";const ce=["Erreur d'emplacement de la zone d'action","Erreur dans le texte à saisir","Lien ne fonctionnant pas","Version ne se chargeant pas","Version incompréhensible","Pictogramme incorrect ou manquant","Problème d'affichage général","Je ne trouve pas ma version de téléphone","Autre"],de="1.0.0",Se=()=>{const S=M(),y=O(),{toast:i}=U(),{currentUser:o}=Y(),[u,I]=r.useState(""),[N,h]=r.useState(""),[t,p]=r.useState(""),[x,T]=r.useState(""),[_,b]=r.useState(""),[g,B]=r.useState([]),[C,E]=r.useState([]),[z,k]=r.useState(0),D=r.useCallback(()=>V(void 0,null,function*(){const s=yield L(!0);return B(s||[]),s||[]}),[]);r.useEffect(()=>{(()=>V(void 0,null,function*(){const n=yield D(),a=new URLSearchParams(S.search),l=a.get("taskId"),v=a.get("versionId"),j=a.get("stepIndex");if(l){p(l);const m=n.find(c=>c.id===l);if(m&&m.versions&&(E(m.versions),v)){T(v);const c=m.versions.find(w=>w.id===v);c&&c.steps&&(k(c.steps.length),j&&b((parseInt(j,10)+1).toString()))}}}))()},[S.search,D]);const $=s=>{p(s);const n=g.find(a=>a.id===s);n&&n.versions?(E(n.versions),T(""),k(0),b("")):E([])},H=s=>{T(s);const n=g.find(a=>a.id===t);if(n){const a=n.versions.find(l=>l.id===s);a&&a.steps?(k(a.steps.length),b("")):k(0)}},J=s=>V(void 0,null,function*(){var j,m,c,w;if(s.preventDefault(),!u.trim()){i({title:"Description manquante",description:"Veuillez décrire l'erreur rencontrée.",variant:"destructive"});return}const n=yield ne(),a=g.length>0?g:yield L(),l=C.length>0?C:((j=a.find(d=>d.id===t))==null?void 0:j.versions)||[],v={user_id:(o==null?void 0:o.id)||null,user_first_name:(o==null?void 0:o.first_name)||"N/A",description:u,category:N,task_id:t||null,exercise_title:((m=a.find(d=>d.id===t))==null?void 0:m.title)||"",version_id:x||null,version_name:((c=l.find(d=>d.id===x))==null?void 0:c.name)||"",version_android:((w=l.find(d=>d.id===x))==null?void 0:w.version)||"",step_index:_?parseInt(_,10):null,app_version:de,exercise_update_date:n.lastUpdate,is_sent:!1};try{yield re(v),i({title:"Signalement envoyé",description:"Merci ! Votre signalement a été envoyé à l'équipe."}),y(-1)}catch(d){i({title:"Erreur d'envoi",description:"Impossible d'envoyer le signalement.",variant:"destructive"})}});return e.jsxs(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"container mx-auto p-4 md:p-8",children:[e.jsxs(Q,{variant:"outline",onClick:()=>y(-1),className:"mb-6",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"})," Retour"]}),e.jsxs(G,{className:"max-w-2xl mx-auto shadow-xl",children:[e.jsxs(K,{className:"bg-gradient-to-r from-primary to-secondary text-primary-foreground",children:[e.jsxs(W,{className:"text-2xl flex items-center",children:[e.jsx(oe,{className:"mr-3 h-6 w-6"})," Signaler une Erreur"]}),e.jsx(X,{className:"text-primary-foreground/90",children:"Aidez-nous à améliorer SARASSURE en signalant les problèmes que vous rencontrez."})]}),e.jsx(ee,{className:"pt-6 space-y-6",children:e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"description",className:"text-lg font-medium",children:"Description de l'erreur *"}),e.jsx(se,{id:"description",value:u,onChange:s=>I(s.target.value),placeholder:"Veuillez décrire le problème le plus précisément possible...",rows:5,required:!0,className:"mt-1 text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"category",children:"Catégorie du problème"}),e.jsxs(F,{value:N,onValueChange:h,children:[e.jsx(A,{id:"category",className:"mt-1 text-base",children:e.jsx(R,{placeholder:"Sélectionnez une catégorie"})}),e.jsx(P,{children:ce.map((s,n)=>e.jsx(q,{value:s,className:"text-base",children:s},n))})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"task",children:"Tâche concernée"}),e.jsxs(F,{value:t,onValueChange:$,children:[e.jsx(A,{id:"task",className:"mt-1 text-base",children:e.jsx(R,{placeholder:"Sélectionnez une tâche"})}),e.jsx(P,{children:g.map(s=>e.jsx(q,{value:s.id,className:"text-base",children:s.title},s.id))})]})]})]}),t&&C.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"version",children:"Version concernée"}),e.jsxs(F,{value:x,onValueChange:H,children:[e.jsx(A,{id:"version",className:"mt-1 text-base",children:e.jsx(R,{placeholder:"Sélectionnez une version"})}),e.jsx(P,{children:C.map(s=>e.jsxs(q,{value:s.id,className:"text-base",children:[s.name," (",s.version,")"]},s.id))})]})]}),x&&z>0&&e.jsxs("div",{children:[e.jsx(f,{htmlFor:"step",children:"Étape concernée (numéro)"}),e.jsx(te,{id:"step",type:"number",value:_,onChange:s=>b(s.target.value),placeholder:`1 à ${z}`,min:"1",max:z,className:"mt-1 text-base"})]})]}),e.jsx(ae,{className:"px-0 pt-6",children:e.jsxs(Q,{type:"submit",size:"lg",className:"w-full bg-green-600 hover:bg-green-700 text-white text-lg",children:[e.jsx(le,{className:"mr-2 h-5 w-5"})," Envoyer le signalement"]})})]})})]})]})};export{Se as default};
