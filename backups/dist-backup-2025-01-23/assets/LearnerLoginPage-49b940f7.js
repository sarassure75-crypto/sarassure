var x=(n,i,a)=>new Promise((c,o)=>{var l=s=>{try{t(a.next(s))}catch(m){o(m)}},r=s=>{try{t(a.throw(s))}catch(m){o(m)}},t=s=>s.done?c(s.value):Promise.resolve(s.value).then(l,r);t((a=a.apply(n,i)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{f,u as h,r as u}from"./react-vendor-6cf6ded9.js";import{u as p,aR as d,i as g,m as j,C as b,k as v,l as N,w as y,j as C,Y as L,I as R,e as E}from"./index-426aa6f1.js";import{t as w}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";const S=({children:n})=>{const{currentUser:i}=p(),a=f(),c=h();return u.useEffect(()=>{var o,l;if(i){const r=(l=(o=c.state)==null?void 0:o.from)==null?void 0:l.pathname;if(r&&r!=="/login"&&r!=="/learner-login"&&r!=="/"){a(r,{replace:!0});return}let t="/";switch(i.role){case d.LEARNER:t="/taches";break;case d.TRAINER:t="/compte-formateur";break;case d.ADMIN:t="/admin/dashboard";break;case d.CONTRIBUTOR:t="/contributeur";break;default:t="/"}a(t,{replace:!0})}},[i,a,c.state]),n},D=()=>{const[n,i]=u.useState(""),[a,c]=u.useState(!1),{loginWithLearnerCode:o}=p(),{toast:l}=g(),r=t=>x(void 0,null,function*(){if(t.preventDefault(),n.length!==6||!/^\d{6}$/.test(n)){l({title:"Code invalide",description:"Le code apprenant doit contenir exactement 6 chiffres.",variant:"destructive"});return}c(!0);try{yield o(n)}catch(s){l({title:"Erreur de connexion",description:s.message||"Une erreur est survenue. Veuillez réessayer.",variant:"destructive"}),c(!1)}});return e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-sky-100 via-indigo-50 to-purple-100 p-4",children:e.jsxs(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col items-center w-full max-w-md",children:[e.jsx("div",{className:"h-32 w-32 mb-6 flex items-center justify-center",children:e.jsx("img",{src:"/logo_large.png",alt:"Logo",className:"max-h-full max-w-full object-contain",onError:t=>{t.target.style.display="none"}})}),e.jsx("h1",{className:"text-4xl font-bold text-primary mb-8",children:"SARASSURE"}),e.jsxs(b,{className:"w-full shadow-xl",children:[e.jsxs(v,{className:"text-center",children:[e.jsx(N,{className:"text-2xl",children:"Accès Apprenant"}),e.jsx(y,{children:"Entrez votre code à 6 chiffres pour vous connecter."})]}),e.jsx(C,{children:e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"learner-code",children:"Code Apprenant"}),e.jsx(R,{id:"learner-code",type:"text",inputMode:"numeric",maxLength:"6",placeholder:"_ _ _ _ _ _",required:!0,value:n,onChange:t=>i(t.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-[0.5em]",disabled:a})]}),e.jsx(E,{type:"submit",className:"w-full",disabled:a,children:a?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):"Se connecter"})]})})]})]})})})};export{D as default};
