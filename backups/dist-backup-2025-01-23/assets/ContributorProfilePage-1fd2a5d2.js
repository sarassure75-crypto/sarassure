var V=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=(r,t,a)=>t in r?V(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,p=(r,t)=>{for(var a in t||(t={}))A.call(t,a)&&S(r,a,t[a]);if(k)for(var a of k(t))D.call(t,a)&&S(r,a,t[a]);return r},x=(r,t)=>q(r,z(t));var P=(r,t,a)=>new Promise((f,g)=>{var d=i=>{try{l(a.next(i))}catch(o){g(o)}},m=i=>{try{l(a.throw(i))}catch(o){g(o)}},l=i=>i.done?f(i.value):Promise.resolve(i.value).then(d,m);l((a=a.apply(r,t)).next())});import{j as e}from"./radix-ui-2f58371e.js";import{r as c}from"./react-vendor-6cf6ded9.js";import{u as M,s as h}from"./index-426aa6f1.js";import{k as L,a7 as $,a0 as C,a1 as _,u as I}from"./ui-icons-e73ce4f7.js";import"./supabase-4b7d20da.js";function H(){const{currentUser:r}=M(),[t,a]=c.useState(!0),[f,g]=c.useState(!1),[d,m]=c.useState(null),[l,i]=c.useState({first_name:"",last_name:"",email:"",pseudonym:"",paypal_email:""}),[o,E]=c.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[u,y]=c.useState({current:!1,new:!1,confirm:!1});c.useEffect(()=>{w()},[r]);const w=()=>P(this,null,function*(){if(r)try{a(!0);const{data:s,error:n}=yield h.from("profiles").select("first_name, last_name, email, pseudonym, paypal_email").eq("id",r.id).single();if(n)throw n;i({first_name:(s==null?void 0:s.first_name)||"",last_name:(s==null?void 0:s.last_name)||"",email:(s==null?void 0:s.email)||r.email||"",pseudonym:(s==null?void 0:s.pseudonym)||"",paypal_email:(s==null?void 0:s.paypal_email)||""})}catch(s){console.error("Erreur chargement profil:",s),m({type:"error",text:"Erreur lors du chargement du profil"})}finally{a(!1)}}),b=s=>{const{name:n,value:v}=s.target;i(N=>x(p({},N),{[n]:v}))},j=s=>{const{name:n,value:v}=s.target;E(N=>x(p({},N),{[n]:v}))},U=()=>P(this,null,function*(){if(r){if(o.newPassword&&o.newPassword!==o.confirmPassword){m({type:"error",text:"Les mots de passe ne correspondent pas"});return}try{g(!0);const{error:s}=yield h.from("profiles").update({first_name:l.first_name,last_name:l.last_name,pseudonym:l.pseudonym,paypal_email:l.paypal_email}).eq("id",r.id);if(s)throw s;if(l.email!==r.email){const{error:n}=yield h.auth.updateUser({email:l.email});if(n)throw n}if(o.newPassword){const{error:n}=yield h.auth.updateUser({password:o.newPassword});if(n)throw n;E({currentPassword:"",newPassword:"",confirmPassword:""})}m({type:"success",text:"✅ Profil mis à jour avec succès"}),setTimeout(w,1500)}catch(s){console.error("Erreur sauvegarde:",s),m({type:"error",text:`❌ Erreur: ${s.message}`})}finally{g(!1)}}});return t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement du profil..."})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Mon Profil Contributeur"}),d&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-center space-x-3 ${d.type==="success"?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"}`,children:[d.type==="success"?e.jsx(L,{className:"w-5 h-5 flex-shrink-0"}):e.jsx($,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:d.text})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Informations Personnelles"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prénom"}),e.jsx("input",{type:"text",name:"first_name",value:l.first_name,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre prénom"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom"}),e.jsx("input",{type:"text",name:"last_name",value:l.last_name,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre nom"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pseudo / Nom d'Utilisateur"}),e.jsx("input",{type:"text",name:"pseudonym",value:l.pseudonym,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre pseudo (visible publiquement)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre email"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email PayPal (pour les paiements)"}),e.jsx("input",{type:"email",name:"paypal_email",value:l.paypal_email,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"votre-email@paypal.com"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cet email sera utilisé pour recevoir vos paiements via PayPal"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Sécurité"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mot de passe actuel (optionnel)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.current?"text":"password",name:"currentPassword",value:o.currentPassword,onChange:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10",placeholder:"Entrez votre mot de passe actuel"}),e.jsx("button",{type:"button",onClick:()=>y(s=>x(p({},s),{current:!s.current})),className:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700",children:u.current?e.jsx(C,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nouveau mot de passe (optionnel)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.new?"text":"password",name:"newPassword",value:o.newPassword,onChange:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10",placeholder:"Entrez un nouveau mot de passe"}),e.jsx("button",{type:"button",onClick:()=>y(s=>x(p({},s),{new:!s.new})),className:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700",children:u.new?e.jsx(C,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmer le nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u.confirm?"text":"password",name:"confirmPassword",value:o.confirmPassword,onChange:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10",placeholder:"Confirmez le nouveau mot de passe"}),e.jsx("button",{type:"button",onClick:()=>y(s=>x(p({},s),{confirm:!s.confirm})),className:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700",children:u.confirm?e.jsx(C,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5"})})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:U,disabled:f,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors font-medium",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:f?"Enregistrement...":"Enregistrer les modifications"})]}),e.jsx("button",{onClick:w,disabled:f,className:"flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 disabled:bg-gray-300 text-gray-800 rounded-lg transition-colors font-medium",children:"Annuler"})]})]})}export{H as default};
