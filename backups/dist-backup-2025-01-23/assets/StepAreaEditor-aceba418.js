var F=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var P=(r,n,c)=>n in r?F(r,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[n]=c,x=(r,n)=>{for(var c in n||(n={}))W.call(n,c)&&P(r,c,n[c]);if(C)for(var c of C(n))H.call(n,c)&&P(r,c,n[c]);return r},f=(r,n)=>X(r,Y(n));import{j as e}from"./radix-ui-2f58371e.js";import{r as p}from"./react-vendor-6cf6ded9.js";import{Y as I,I as R,e as T,a as B,F as q,B as O,M as V,b as U,H as G,d as J}from"./index-426aa6f1.js";import{S as K,a as Q,b as Z,c as A,d as E}from"./select-6c123d42.js";import{X as ee,E as te}from"./ui-icons-e73ce4f7.js";import{I as se}from"./IconSelector-7450d470.js";const ie=r=>{const n=r.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(n){const c=parseInt(n[1]).toString(16).padStart(2,"0"),v=parseInt(n[2]).toString(16).padStart(2,"0"),h=parseInt(n[3]).toString(16).padStart(2,"0");return`#${c}${v}${h}`}return"#3b82f6"},ne=r=>{if(!r)return null;if(r.includes(":")&&(r.startsWith("logos:")||r.startsWith("skill-icons:")||r.startsWith("devicon:")))return N=>e.jsx(B,x({icon:r},N));const[n,c]=r.split(":"),h={lucide:te,fa6:q,bs:O,md:V,fi:U,hi2:G,ai:J}[n];return h?h[c]:null},re=({area:r,imageDimensions:n,onMouseDown:c,onResizeMouseDown:v})=>{if(!r||!n.width)return null;const h=["top-left","top-right","bottom-left","bottom-right"],N=(r.x_percent||0)*n.width/100,l=(r.y_percent||0)*n.height/100,S=(r.width_percent||0)*n.width/100,u=(r.height_percent||0)*n.height/100,y=r.color||"rgb(59, 130, 246)",t=r.opacity!==void 0?r.opacity:.5,m=`${y.replace(")",`, ${t})`)}`,_=y,z={left:`${N}px`,top:`${l}px`,width:`${S}px`,height:`${u}px`,backgroundColor:m,borderColor:_,borderRadius:r.shape==="ellipse"?"50%":"8px",position:"absolute",borderWidth:"3px",borderStyle:"solid",cursor:"grab",boxSizing:"border-box",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.3), inset 0 0 0 1px rgba(255,255,255,0.4)",transition:"box-shadow 0.2s ease"};return e.jsxs("div",{style:z,onMouseDown:c,className:"group hover:shadow-lg flex items-center justify-center",title:"Cliquez et glissez pour d√©placer",children:[r.icon_name&&e.jsx("div",{className:"absolute pointer-events-none flex items-center justify-center",style:{zIndex:20},children:(()=>{const d=ne(r.icon_name);return d?e.jsx(d,{className:"text-white",style:{fontSize:"3rem"}}):null})()}),!r.icon_name&&e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 opacity-60",children:[e.jsx("div",{className:"w-6 h-1 bg-white rounded-full"}),e.jsx("div",{className:"w-6 h-1 bg-white rounded-full"}),e.jsx("div",{className:"w-6 h-1 bg-white rounded-full"})]})}),!r.icon_name&&e.jsx("div",{className:"absolute top-1 left-1 text-xs font-bold text-white opacity-75 pointer-events-none",children:"‚ãÆ‚ãÆ"}),h.map(d=>e.jsx("div",{className:`absolute bg-white border-2 border-blue-500 rounded-full w-4 h-4 -m-2 shadow-md z-10
              ${d.includes("left")?"left-0":"right-0"}
              ${d.includes("top")?"top-0":"bottom-0"}
              cursor-${d.includes("top")&&d.includes("left")||d.includes("bottom")&&d.includes("right")?"nwse":"nesw"}-resize
              hover:bg-blue-100 hover:scale-125 transition-all
          `,onMouseDown:M=>v(M,d),title:`Redimensionner: ${d}`},d))]})},oe=({imageUrl:r,area:n,onAreaChange:c,onImageLoad:v})=>{const h=p.useRef(null),N=p.useRef(null),[l,S]=p.useState({width:0,height:0}),[u,y]=p.useState(null),[t,m]=p.useState(n);p.useEffect(()=>{if(!n&&l.width>0){const s={x_percent:25,y_percent:25,width_percent:50,height_percent:50,color:"rgb(59, 130, 246)",opacity:.5,shape:"rect",is_visible:!0};m(s),c(s)}else if(n){const s=f(x({},n),{color:n.color||"rgb(59, 130, 246)",opacity:n.opacity!==void 0?n.opacity:.5,shape:n.shape||"rect",is_visible:n.is_visible!==void 0?n.is_visible:!0});m(s)}else t||m({x_percent:25,y_percent:25,width_percent:50,height_percent:50,color:"rgb(59, 130, 246)",opacity:.5,shape:"rect",is_visible:!0})},[n,l.width,c]);const _=p.useCallback(()=>{if(h.current&&h.current.complete){const s=h.current.getBoundingClientRect(),o={width:s.width,height:s.height};S(o),v&&v(o)}},[v]);p.useEffect(()=>{const s=h.current;if(s){const o=new ResizeObserver(_);o.observe(s);const a=()=>_();return s.addEventListener("load",a),s.complete&&a(),()=>{o.disconnect(),s.removeEventListener("load",a)}}},[r,_]);const z=p.useCallback(s=>{if(s.preventDefault(),s.stopPropagation(),!t)return;const o=s.clientX,a=s.clientY,b=(t.x_percent||0)*l.width/100,g=(t.y_percent||0)*l.height/100,i=(t.width_percent||0)*l.width/100,w=(t.height_percent||0)*l.height/100,j=f(x({},t),{x:b,y:g,width:i,height:w});y({type:"move",startX:o,startY:a,initialArea:j})},[t,l]),d=p.useCallback((s,o)=>{if(s.preventDefault(),s.stopPropagation(),!t)return;const a=s.clientX,b=s.clientY,g=(t.x_percent||0)*l.width/100,i=(t.y_percent||0)*l.height/100,w=(t.width_percent||0)*l.width/100,j=(t.height_percent||0)*l.height/100,L=f(x({},t),{x:g,y:i,width:w,height:j});y({type:"resize",handleName:o,startX:a,startY:b,initialArea:L})},[t,l]);p.useEffect(()=>{const s=a=>{if(!u||!l.width)return;const b=a.clientX-u.startX,g=a.clientY-u.startY;let i=x({},u.initialArea);if(u.type==="move")i.x+=b,i.y+=g;else if(u.type==="resize"){const{handleName:j}=u;j.includes("left")&&(i.x+=b,i.width-=b),j.includes("top")&&(i.y+=g,i.height-=g),j.includes("right")&&(i.width+=b),j.includes("bottom")&&(i.height+=g)}i.width<0&&(i.x=i.x+i.width,i.width=Math.abs(i.width)),i.height<0&&(i.y=i.y+i.height,i.height=Math.abs(i.height)),i.width=Math.max(10,i.width),i.height=Math.max(10,i.height),i.x=Math.max(0,Math.min(i.x,l.width-i.width)),i.y=Math.max(0,Math.min(i.y,l.height-i.height));const w=f(x({},i),{x_percent:i.x/l.width*100,y_percent:i.y/l.height*100,width_percent:i.width/l.width*100,height_percent:i.height/l.height*100,color:t.color||"rgb(59, 130, 246)",opacity:t.opacity!==void 0?t.opacity:.3,shape:t.shape||"rect",is_visible:t.is_visible!==void 0?t.is_visible:!0});c(w),m(w)},o=()=>{y(null)};return document.addEventListener("mousemove",s),document.addEventListener("mouseup",o),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)}},[u,l,c]);const M=s=>{const o=f(x({},t),{color:s});m(o),c(o)},D=s=>{const o=f(x({},t),{opacity:s});m(o),c(o)},k=s=>{const o=f(x({},t),{shape:s});m(o),c(o)},$=s=>{const o=s?`${s.library}:${s.name}`:null,a=f(x({},t),{icon_name:o});m(a),c(a)};return e.jsxs("div",{className:"space-y-4",children:[!t&&e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-700 text-sm",children:"Chargement de la zone d'action..."}),t&&e.jsx("div",{className:"p-4 bg-white border rounded-md space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"area-color",className:"text-sm font-medium block mb-2",children:"Couleur"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(R,{id:"area-color",type:"color",value:ie((t==null?void 0:t.color)||"rgb(59, 130, 246)"),onChange:s=>{const o=parseInt(s.target.value.substring(1),16),a=o>>16&255,b=o>>8&255,g=o&255;M(`rgb(${a}, ${b}, ${g})`)},className:"h-10 w-16 cursor-pointer"}),e.jsx("div",{className:"w-12 h-10 border-2 border-gray-300 rounded",style:{backgroundColor:`${(t==null?void 0:t.color)||"rgb(59, 130, 246)"}${(t==null?void 0:t.opacity)!==void 0?Math.round(t.opacity*255).toString(16).padStart(2,"0"):"80"}`}})]})]}),e.jsxs("div",{children:[e.jsxs(I,{htmlFor:"area-opacity",className:"text-sm font-medium block mb-2",children:["Transparence: ",Math.round(((t==null?void 0:t.opacity)||.5)*100),"%"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(R,{id:"area-opacity",type:"range",min:"0",max:"1",step:"0.05",value:(t==null?void 0:t.opacity)||.5,onChange:s=>D(parseFloat(s.target.value)),className:"flex-1 h-2"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-600 w-8",children:[Math.round(((t==null?void 0:t.opacity)||.5)*100),"%"]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Aper√ßu:"}),e.jsx("div",{className:"flex gap-1",children:[.2,.5,.8].map(s=>e.jsx("div",{className:"flex-1 h-8 border border-gray-300 rounded",style:{backgroundColor:`${(t==null?void 0:t.color)||"rgb(59, 130, 246)"}${Math.round(s*255).toString(16).padStart(2,"0")}`}},s))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"20% - 50% - 80%"})]})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"area-shape",className:"text-sm font-medium block mb-2",children:"Forme"}),e.jsxs(K,{value:(t==null?void 0:t.shape)||"rect",onValueChange:k,children:[e.jsx(Q,{id:"area-shape",className:"h-10",children:e.jsx(Z,{})}),e.jsxs(A,{children:[e.jsx(E,{value:"rect",children:"‚ñ≠ Rectangle"}),e.jsx(E,{value:"ellipse",children:"‚óØ Ellipse"})]})]})]})]})}),t&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-md space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-amber-900",children:"üé® Ic√¥ne de la zone (optionnel)"}),t.icon_name&&e.jsxs(T,{variant:"ghost",size:"sm",onClick:()=>$(null),className:"h-6 text-amber-600 hover:text-amber-700",children:[e.jsx(ee,{className:"h-4 w-4"})," Supprimer"]})]}),e.jsx("p",{className:"text-xs text-amber-700 italic",children:"S√©lectionnez une ic√¥ne pour remplacer la zone transparente. L'ic√¥ne s'affichera au centre de la zone."}),t.icon_name&&e.jsxs("div",{className:"p-2 bg-white border border-amber-300 rounded flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-amber-900",children:"Ic√¥ne s√©lectionn√©e:"}),e.jsx("span",{className:"text-sm font-mono text-amber-700",children:t.icon_name})]}),e.jsx(se,{onSelect:$,onRemove:()=>$(null),libraries:["lucide","fa6","bs","md","fi","hi2","ai","logos","skill","devicon"],showSearch:!0,showLibraryTabs:!0})]}),t&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Coordonn√©es de la zone:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Position X:"}),e.jsxs("p",{className:"font-mono font-bold text-blue-700",children:[Math.round(t.x_percent||0),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Position Y:"}),e.jsxs("p",{className:"font-mono font-bold text-blue-700",children:[Math.round(t.y_percent||0),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Largeur:"}),e.jsxs("p",{className:"font-mono font-bold text-blue-700",children:[Math.round(t.width_percent||0),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Hauteur:"}),e.jsxs("p",{className:"font-mono font-bold text-blue-700",children:[Math.round(t.height_percent||0),"%"]})]})]})]}),e.jsxs("div",{ref:N,className:"relative mx-auto border-4 border-gray-400 rounded-lg bg-gray-900 overflow-auto shadow-2xl",style:{maxWidth:"100%",maxHeight:"85vh",aspectRatio:"9/16"},children:[e.jsx("img",{ref:h,src:r,alt:"Aper√ßu de l'√©tape",className:"w-full h-full object-contain select-none",onDragStart:s=>s.preventDefault()}),t&&e.jsx(re,{area:t,imageDimensions:l,onMouseDown:z,onResizeMouseDown:d})]}),e.jsxs("div",{className:"space-y-2 text-xs p-3 bg-blue-50 rounded border-l-4 border-l-blue-500 border border-blue-200",children:[e.jsxs("p",{className:"font-semibold text-blue-900 flex items-center gap-2",children:["üì± ",e.jsx("span",{children:"Mode Smartphone - Interaction sur la zone:"})]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"D√©placer la zone:"})," Cliquez et glissez la bo√Æte bleue (comme sur votre t√©l√©phone)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Redimensionner:"})," Utilisez les 4 points blancs aux coins"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Personnaliser:"})," Changez couleur, transparence et forme au-dessus"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ajouter une ic√¥ne:"})," S√©lectionnez une ic√¥ne pour l'afficher dans la zone (remplace les lignes ‚ãÆ‚ãÆ)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Texte blanc:"})," Les trois lignes ‚ãÆ‚ãÆ indiquent le point de saisie (dispara√Æt avec une ic√¥ne)"]})]})]})]})},ue=oe;export{ue as S};
