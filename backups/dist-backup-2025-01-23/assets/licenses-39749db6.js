var p=Object.defineProperty,w=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var f=(a,r,e)=>r in a?p(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e,g=(a,r)=>{for(var e in r||(r={}))h.call(r,e)&&f(a,e,r[e]);if(y)for(var e of y(r))E.call(r,e)&&f(a,e,r[e]);return a},u=(a,r)=>w(a,m(r));var c=(a,r,e)=>new Promise((s,t)=>{var n=l=>{try{d(e.next(l))}catch(_){t(_)}},o=l=>{try{d(e.throw(l))}catch(_){t(_)}},d=l=>l.done?s(l.value):Promise.resolve(l.value).then(n,o);d((e=e.apply(a,r)).next())});import{s as i}from"./index-426aa6f1.js";const q=a=>c(void 0,null,function*(){const{data:r,error:e}=yield i.from("trainer_category_licenses").select(`
      *,
      category:task_categories(*)
    `).eq("trainer_id",a).eq("is_active",!0);if(e)throw console.error("Erreur lors de la récupération des licences:",e),e;return r||[]}),C=(a,r,e=null)=>c(void 0,null,function*(){const{data:s,error:t}=yield i.from("trainer_category_licenses").upsert({trainer_id:a,category_id:r,is_active:!0,expires_at:e},{onConflict:"trainer_id,category_id"}).select().single();if(t)throw console.error("Erreur lors de l'activation de la licence:",t),t;return s}),x=(a,r)=>c(void 0,null,function*(){const{error:e}=yield i.from("trainer_category_licenses").update({is_active:!1}).eq("trainer_id",a).eq("category_id",r);if(e)throw console.error("Erreur lors de la désactivation de la licence:",e),e}),b=a=>c(void 0,null,function*(){const{data:r,error:e}=yield i.from("task_categories").select("*").order("name");if(e)throw console.error("Erreur lors de la récupération des catégories:",e),e;const{data:s,error:t}=yield i.from("trainer_category_licenses").select("category_id, is_active, expires_at").eq("trainer_id",a);if(t)throw console.error("Erreur lors de la récupération des licences:",t),t;const n=new Map((s==null?void 0:s.map(o=>[o.category_id,o]))||[]);return r.map(o=>{var d;return u(g({},o),{hasLicense:n.has(o.id)&&n.get(o.id).is_active,expiresAt:(d=n.get(o.id))==null?void 0:d.expires_at})})}),S=(a,r,e=null)=>c(void 0,null,function*(){const{data:s,error:t}=yield i.from("learner_category_licenses").upsert({learner_id:a,category_id:r,assigned_by_trainer_id:e},{onConflict:"learner_id,category_id"}).select().single();if(t)throw console.error("Erreur lors de l'attribution de la catégorie:",t),t;return s}),k=(a,r)=>c(void 0,null,function*(){const{error:e}=yield i.from("learner_category_licenses").delete().eq("learner_id",a).eq("category_id",r);if(e)throw console.error("Erreur lors du retrait de la catégorie:",e),e}),F=a=>c(void 0,null,function*(){const{data:r,error:e}=yield i.from("task_categories").select("*").order("name");if(e)throw console.error("Erreur lors de la récupération des catégories:",e),e;const{data:s,error:t}=yield i.from("learner_category_licenses").select("category_id").eq("learner_id",a);if(t)throw console.error("Erreur lors de la récupération des licences:",t),t;const n=new Set((s||[]).map(o=>o.category_id));return r.map(o=>u(g({},o),{hasLicense:n.has(o.id)}))});export{C as a,F as b,S as c,x as d,q as e,b as g,k as r};
