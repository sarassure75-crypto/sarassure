var P=(u,a,s)=>new Promise((i,t)=>{var e=o=>{try{r(s.next(o))}catch(c){t(c)}},n=o=>{try{r(s.throw(o))}catch(c){t(c)}},r=o=>o.done?i(o.value):Promise.resolve(o.value).then(e,n);r((s=s.apply(u,a)).next())});import{j as Q}from"./radix-ui-2f58371e.js";import{e as b,r as $}from"./react-vendor-6cf6ded9.js";import{_ as W,x as w,y as q,z as L,E as _,G as z,J as V,K as A,L as j,N as G,O as J,Q as O,R as H,T as X,U as Y,s as k}from"./index-426aa6f1.js";import{t as Z}from"./ui-icons-e73ce4f7.js";var ee=function(u){W(a,u);function a(i,t){var e;return e=u.call(this)||this,e.client=i,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var s=a.prototype;return s.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},s.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),M(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},s.onUnsubscribe=function(){this.listeners.length||this.destroy()},s.shouldFetchOnReconnect=function(){return E(this.currentQuery,this.options,this.options.refetchOnReconnect)},s.shouldFetchOnWindowFocus=function(){return E(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},s.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},s.setOptions=function(t,e){var n=this.options,r=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled!="undefined"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=n.queryKey),this.updateQuery();var o=this.hasListeners();o&&N(this.currentQuery,r,this.options,n)&&this.executeFetch(),this.updateResult(e),o&&(this.currentQuery!==r||this.options.enabled!==n.enabled||this.options.staleTime!==n.staleTime)&&this.updateStaleTimeout();var c=this.computeRefetchInterval();o&&(this.currentQuery!==r||this.options.enabled!==n.enabled||c!==this.currentRefetchInterval)&&this.updateRefetchInterval(c)},s.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),n=this.client.getQueryCache().build(this.client,e);return this.createResult(n,e)},s.getCurrentResult=function(){return this.currentResult},s.trackResult=function(t,e){var n=this,r={},o=function(h){n.trackedProps.includes(h)||n.trackedProps.push(h)};return Object.keys(t).forEach(function(c){Object.defineProperty(r,c,{configurable:!1,enumerable:!0,get:function(){return o(c),t[c]}})}),(e.useErrorBoundary||e.suspense)&&o("error"),r},s.getNextResult=function(t){var e=this;return new Promise(function(n,r){var o=e.subscribe(function(c){c.isFetching||(o(),c.isError&&(t!=null&&t.throwOnError)?r(c.error):n(c))})})},s.getCurrentQuery=function(){return this.currentQuery},s.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},s.refetch=function(t){return this.fetch(w({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},s.fetchOptimistic=function(t){var e=this,n=this.client.defaultQueryObserverOptions(t),r=this.client.getQueryCache().build(this.client,n);return r.fetch().then(function(){return e.createResult(r,n)})},s.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},s.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(q)),e},s.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(L||this.currentResult.isStale||!_(this.options.staleTime))){var e=z(this.currentResult.dataUpdatedAt,this.options.staleTime),n=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},n)}},s.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},s.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(L||this.options.enabled===!1||!_(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||V.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},s.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},s.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},s.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},s.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},s.createResult=function(t,e){var n=this.currentQuery,r=this.options,o=this.currentResult,c=this.currentResultState,h=this.currentResultOptions,d=t!==n,v=d?t.state:this.currentQueryInitialState,R=d?this.currentResult:this.previousQueryResult,l=t.state,m=l.dataUpdatedAt,C=l.error,T=l.errorUpdatedAt,S=l.isFetching,f=l.status,x=!1,U=!1,p;if(e.optimisticResults){var F=this.hasListeners(),D=!F&&M(t,e),B=F&&N(t,n,e,r);(D||B)&&(S=!0,m||(f="loading"))}if(e.keepPreviousData&&!l.dataUpdateCount&&(R!=null&&R.isSuccess)&&f!=="error")p=R.data,m=R.dataUpdatedAt,f=R.status,x=!0;else if(e.select&&typeof l.data!="undefined")if(o&&l.data===(c==null?void 0:c.data)&&e.select===this.selectFn)p=this.selectResult;else try{this.selectFn=e.select,p=e.select(l.data),e.structuralSharing!==!1&&(p=A(o==null?void 0:o.data,p)),this.selectResult=p,this.selectError=null}catch(g){j().error(g),this.selectError=g}else p=l.data;if(typeof e.placeholderData!="undefined"&&typeof p=="undefined"&&(f==="loading"||f==="idle")){var y;if(o!=null&&o.isPlaceholderData&&e.placeholderData===(h==null?void 0:h.placeholderData))y=o.data;else if(y=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof y!="undefined")try{y=e.select(y),e.structuralSharing!==!1&&(y=A(o==null?void 0:o.data,y)),this.selectError=null}catch(g){j().error(g),this.selectError=g}typeof y!="undefined"&&(f="success",p=y,U=!0)}this.selectError&&(C=this.selectError,p=this.selectResult,T=Date.now(),f="error");var K={status:f,isLoading:f==="loading",isSuccess:f==="success",isError:f==="error",isIdle:f==="idle",data:p,dataUpdatedAt:m,error:C,errorUpdatedAt:T,failureCount:l.fetchFailureCount,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>v.dataUpdateCount||l.errorUpdateCount>v.errorUpdateCount,isFetching:S,isRefetching:S&&f!=="loading",isLoadingError:f==="error"&&l.dataUpdatedAt===0,isPlaceholderData:U,isPreviousData:x,isRefetchError:f==="error"&&l.dataUpdatedAt!==0,isStale:I(t,e),refetch:this.refetch,remove:this.remove};return K},s.shouldNotifyListeners=function(t,e){if(!e)return!0;var n=this.options,r=n.notifyOnChangeProps,o=n.notifyOnChangePropsExclusions;if(!r&&!o||r==="tracked"&&!this.trackedProps.length)return!0;var c=r==="tracked"?this.trackedProps:r;return Object.keys(t).some(function(h){var d=h,v=t[d]!==e[d],R=c==null?void 0:c.some(function(m){return m===h}),l=o==null?void 0:o.some(function(m){return m===h});return v&&!l&&(!c||R)})},s.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!G(this.currentResult,e)){var n={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(n.listeners=!0),this.notify(w({},n,t))}},s.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},s.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!J(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},s.notify=function(t){var e=this;O.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(n){n(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},a}(H);function te(u,a){return a.enabled!==!1&&!u.state.dataUpdatedAt&&!(u.state.status==="error"&&a.retryOnMount===!1)}function M(u,a){return te(u,a)||u.state.dataUpdatedAt>0&&E(u,a,a.refetchOnMount)}function E(u,a,s){if(a.enabled!==!1){var i=typeof s=="function"?s(u):s;return i==="always"||i!==!1&&I(u,a)}return!1}function N(u,a,s,i){return s.enabled!==!1&&(u!==a||i.enabled===!1)&&(!s.suspense||u.state.status!=="error")&&I(u,s)}function I(u,a){return u.isStaleByTime(a.staleTime)}function re(){var u=!1;return{clearReset:function(){u=!1},reset:function(){u=!0},isReset:function(){return u}}}var se=b.createContext(re()),ie=function(){return b.useContext(se)};function ne(u,a,s){return typeof a=="function"?a.apply(void 0,s):typeof a=="boolean"?a:!!u}function ue(u,a){var s=b.useRef(!1),i=b.useState(0),t=i[1],e=X(),n=ie(),r=e.defaultQueryObserverOptions(u);r.optimisticResults=!0,r.onError&&(r.onError=O.batchCalls(r.onError)),r.onSuccess&&(r.onSuccess=O.batchCalls(r.onSuccess)),r.onSettled&&(r.onSettled=O.batchCalls(r.onSettled)),r.suspense&&(typeof r.staleTime!="number"&&(r.staleTime=1e3),r.cacheTime===0&&(r.cacheTime=1)),(r.suspense||r.useErrorBoundary)&&(n.isReset()||(r.retryOnMount=!1));var o=b.useState(function(){return new a(e,r)}),c=o[0],h=c.getOptimisticResult(r);if(b.useEffect(function(){s.current=!0,n.clearReset();var d=c.subscribe(O.batchCalls(function(){s.current&&t(function(v){return v+1})}));return c.updateResult(),function(){s.current=!1,d()}},[n,c]),b.useEffect(function(){c.setOptions(r,{listeners:!1})},[r,c]),r.suspense&&h.isLoading)throw c.fetchOptimistic(r).then(function(d){var v=d.data;r.onSuccess==null||r.onSuccess(v),r.onSettled==null||r.onSettled(v,null)}).catch(function(d){n.clearReset(),r.onError==null||r.onError(d),r.onSettled==null||r.onSettled(void 0,d)});if(h.isError&&!n.isReset()&&!h.isFetching&&ne(r.suspense,r.useErrorBoundary,[h.error,c.getCurrentQuery()]))throw h.error;return r.notifyOnChangeProps==="tracked"&&(h=c.trackResult(h,r)),h}function ae(u,a,s){var i=Y(u,a,s);return ue(i,ee)}const oe=u=>P(void 0,null,function*(){if(!u)return null;const{data:a,error:s}=yield k.from("app_images").select("file_path").eq("id",u).single();if(s||!a)return console.error("Error fetching image path:",s),null;const{data:i}=k.storage.from("images").getPublicUrl(a.file_path);return i.publicUrl}),ce=$.forwardRef(({imageId:u,alt:a,className:s,onLoad:i,style:t},e)=>{const{data:n,isLoading:r,isError:o}=ae(["imageUrl",u],()=>oe(u),{enabled:!!u,staleTime:1/0,cacheTime:1/0});return r?Q.jsx("div",{className:s+" flex items-center justify-center bg-muted/30",children:Q.jsx(Z,{className:"h-6 w-6 animate-spin text-primary"})}):o||!n?Q.jsx("div",{className:s+" flex items-center justify-center bg-muted/30",children:Q.jsx("span",{className:"text-xs text-destructive",children:"Image non disponible"})}):Q.jsx("img",{ref:e,src:n,alt:a,className:s,style:t,onLoad:i,loading:"lazy",decoding:"async",crossOrigin:"anonymous"})});ce.displayName="ImageFromSupabase";export{ce as I};
