<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <title>ğŸš€ PWA Testing Tool</title>
</head>
<body>
    <header>
        <h1>ğŸš€ PWA Testing Tool</h1>
        <p>Testez votre application sur navigateur et mobile</p>
    </header>

    <main>
        <section class="card">
            <h2>ğŸ“± Bienvenue!</h2>
            <p>Cet outil vous permet de visualiser et tester votre application PWA sur diffÃ©rents appareils et navigateurs.</p>
        </section>

        <section class="card">
            <h2>âœ¨ FonctionnalitÃ©s disponibles</h2>
            <ul>
                <li>âœ… Test des fonctions tactiles (tap, swipe, pinch)</li>
                <li>âœ… Responsive design sur tous les appareils</li>
                <li>âœ… Installation en tant qu'application</li>
                <li>âœ… Mode offline aprÃ¨s installation</li>
                <li>âœ… Performance et mÃ©triques</li>
            </ul>
        </section>

        <section class="card">
            <h2>ğŸ“Š Ã‰tat du PWA</h2>
            <div id="pwa-status">
                <p>DÃ©tection en cours...</p>
            </div>
        </section>

        <section class="card">
            <h2>ğŸ® Tests interactifs</h2>
            <div class="test-buttons">
                <button onclick="testTouch()">Tester le tactile</button>
                <button onclick="testOrientation()">Orientation</button>
                <button onclick="testGeolocation()">GÃ©olocalisation</button>
                <button onclick="testStorage()">Stockage</button>
            </div>
        </section>

        <section class="card">
            <h2>ğŸ“² AccÃ¨s mobile</h2>
            <p>Depuis votre tÃ©lÃ©phone sur le mÃªme rÃ©seau WiFi:</p>
            <code id="mobile-url">DÃ©tection de l'adresse IP...</code>
            <p class="hint">ğŸ’¡ Cherchez votre adresse IPv4 avec: <code>ipconfig</code></p>
        </section>

        <section class="card">
            <h2>ğŸ“ Console de dÃ©bogage</h2>
            <div id="debug-console" class="console"></div>
        </section>
    </main>

    <footer>
        <p>Version 1.0.0 | PWA Testing Tool</p>
    </footer>

    <script>
        // Initialize PWA status
        function initPWA() {
            const statusDiv = document.getElementById('pwa-status');
            const isHttps = window.location.protocol === 'https:';
            const hasServiceWorker = 'serviceWorker' in navigator;
            
            statusDiv.innerHTML = `
                <p>ğŸ”’ HTTPS: <strong>${isHttps ? 'âœ… ActivÃ©' : 'âŒ Non disponible'}</strong></p>
                <p>âš™ï¸ Service Worker: <strong>${hasServiceWorker ? 'âœ… SupportÃ©' : 'âŒ Non supportÃ©'}</strong></p>
                <p>ğŸ“± Plateforme: <strong>${navigator.platform}</strong></p>
                <p>ğŸŒ User Agent: <strong>${navigator.userAgentData?.platform || 'DÃ©tection...'}</strong></p>
            `;

            // Try to install service worker
            if (hasServiceWorker) {
                navigator.serviceWorker.register('sw.js').catch(e => {
                    console.log('Service Worker registration not available');
                });
            }
        }

        // Get local IP address
        function getLocalIP() {
            const mobileUrlDiv = document.getElementById('mobile-url');
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            const port = window.location.port || (protocol === 'https:' ? 443 : 80);
            
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                mobileUrlDiv.textContent = 'http://<YOUR_IP_ADDRESS>:' + port;
            } else {
                mobileUrlDiv.textContent = protocol + '//' + hostname + ':' + port;
            }
        }

        // Test functions
        function logDebug(message) {
            const console = document.getElementById('debug-console');
            const timestamp = new Date().toLocaleTimeString();
            const p = document.createElement('p');
            p.textContent = `[${timestamp}] ${message}`;
            console.appendChild(p);
            console.scrollTop = console.scrollHeight;
        }

        function testTouch() {
            logDebug('ğŸ¯ Test tactile activÃ© - Touchez l\'Ã©cran');
            document.addEventListener('touchstart', (e) => {
                logDebug(`ğŸ‘† Touch dÃ©tectÃ©: ${e.touches.length} doigt(s)`);
            }, { once: true });
        }

        function testOrientation() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', (event) => {
                    logDebug(`ğŸ“ Orientation - Alpha: ${Math.round(event.alpha)}Â°, Beta: ${Math.round(event.beta)}Â°, Gamma: ${Math.round(event.gamma)}Â°`);
                }, { once: true });
                logDebug('ğŸ“ Orientation activÃ©e - Bougez votre appareil');
            } else {
                logDebug('âŒ DeviceOrientation non supportÃ©');
            }
        }

        function testGeolocation() {
            if (navigator.geolocation) {
                logDebug('ğŸ“ Demande de gÃ©olocalisation...');
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(4);
                        const lng = position.coords.longitude.toFixed(4);
                        logDebug(`âœ… Position: ${lat}, ${lng}`);
                    },
                    (error) => {
                        logDebug(`âŒ Erreur: ${error.message}`);
                    }
                );
            } else {
                logDebug('âŒ GÃ©olocalisation non supportÃ©e');
            }
        }

        function testStorage() {
            try {
                const testKey = 'pwa-test-' + Date.now();
                localStorage.setItem(testKey, 'test-value');
                const value = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                logDebug(`âœ… localStorage fonctionne (${(navigator.storage?.estimate?.usage || 0) / 1024 / 1024 | 0}MB utilisÃ©s)`);
            } catch (e) {
                logDebug(`âŒ Erreur localStorage: ${e.message}`);
            }
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initPWA();
            getLocalIP();
            logDebug('âœ… PWA Testing Tool chargÃ© avec succÃ¨s');
        });
    </script>
</body>
</html>